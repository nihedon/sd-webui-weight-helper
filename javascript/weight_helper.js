"use strict";(()=>{var S={lora:"lora",lycoris:"lycoris",Unknown:"Unknown"},y={SD:"SD",SDXL:"SDXL",Flux:"Flux",Unknown:"Unknown"},P={te:"te",unet:"unet",start:"start",stop:"stop",step:"step",lbw:"lbw",lbwe:"lbwe"},m={TENC:"TEnc",UNET:"UNet",START:"Start",STOP:"Stop",LBW:"LBW"};var De={STABLE_DIFFUSION:["BASE","IN00","IN01","IN02","IN03","IN04","IN05","IN06","IN07","IN08","IN09","IN10","IN11","M00","OUT00","OUT01","OUT02","OUT03","OUT04","OUT05","OUT06","OUT07","OUT08","OUT09","OUT10","OUT11"],BLACK_FOREST_LABS:["CLIP","T5","IN","D00","D01","D02","D03","D04","D05","D06","D07","D08","D09","D10","D11","D12","D13","D14","D15","D16","D17","D18","S00","S01","S02","S03","S04","S05","S06","S07","S08","S09","S10","S11","S12","S13","S14","S15","S16","S17","S18","S19","S20","S21","S22","S23","S24","S25","S26","S27","S28","S29","S30","S31","S32","S33","S34","S35","S36","S37","OUT"]},ne={[y.SD]:De.STABLE_DIFFUSION,[y.SDXL]:De.STABLE_DIFFUSION,[y.Flux]:De.BLACK_FOREST_LABS,[y.Unknown]:[]},rt={[y.SD]:{[S.lora]:[1,0,1,1,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1],[S.lycoris]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[S.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[y.SDXL]:{[S.lora]:[1,0,0,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0],[S.lycoris]:[1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[S.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[y.Flux]:{[S.lora]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[S.lycoris]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[S.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[y.Unknown]:{[S.lora]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[S.lycoris]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[S.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},nt={[y.SD]:{[S.lora]:"XYZ(17)",[S.lycoris]:"XYZ(26)",[S.Unknown]:"XYZ(26)"},[y.SDXL]:{[S.lora]:"XYZ(12)",[S.lycoris]:"XYZ(20)",[S.Unknown]:"XYZ(26)"},[y.Flux]:{[S.lora]:"XYZ(19)",[S.lycoris]:"XYZ(19)",[S.Unknown]:"XYZ(19)"},[y.Unknown]:{[S.lora]:"XYZ(17)",[S.lycoris]:"XYZ(26)",[S.Unknown]:"XYZ(26)"}},K={"":y.Unknown,SD:y.SD,SDXL:y.SDXL,Flux:y.Flux},J={"":S.Unknown,"LoRA(LierLa)":S.lora,"LyCORIS,etc":S.lycoris},be="./file=html/card-no-preview.png";var ye={[m.TENC]:{min:0,max:0,default:1,step:.5},[m.UNET]:{min:0,max:0,default:0,step:.5},[m.START]:{min:0,max:0,default:0,step:1},[m.STOP]:{min:0,max:0,default:0,step:1},[m.LBW]:{min:0,max:0,default:1,step:.5}},st={[y.SD]:{[S.lora]:[["BASE","IN01-IN04","IN05-IN08","M00","OUT03-OUT06","OUT07-OUT11"]],[S.lycoris]:[["BASE","IN00-IN05","IN06-IN11","M00","OUT00-OUT05","OUT06-OUT11"]],[S.Unknown]:[[]]},[y.SDXL]:{[S.lora]:[["BASE","IN04-IN08","M00","OUT00-OUT05"]],[S.lycoris]:[["BASE","IN00-IN03","IN04-IN08","M00","OUT00-OUT03","OUT04-OUT08"]],[S.Unknown]:[[]]},[y.Flux]:{[S.lora]:[["CLIP","T5","IN","OUT"],["D00-D18"],["S00-S18"],["S19-S37"]],[S.lycoris]:[["CLIP","T5","IN","OUT"],["D00-D18"],["S00-S18"],["S19-S37"]],[S.Unknown]:[[]]},[y.Unknown]:{[S.lora]:[[]],[S.lycoris]:[[]],[S.Unknown]:[[]]}};function at(){let e=/((BASE|MID|M00|CLIP|T5|(IN|OUT|D|S)[0-9]{2}(-(IN|OUT|D|S)[0-9]{2})?) *(, *|$))+/;for(let t of Object.values(K))if(!(t===y.Unknown||t===y.Flux)){for(let o of Object.values(J))if(o!==S.Unknown)try{let r=opts[`weight_helper_LBW_${t}_${o}_block_points`];if(r=r.replace("MID","M00"),e.exec(r)){let n=r.split(",").map(a=>a.trim().replace(/\d+/g,s=>s.length===1?`0${s}`:s));st[t][o]=[n]}}catch(r){console.warn(`${t}_${o} block definition format is invalid.`,r)}}for(let t of[m.TENC,m.UNET,m.LBW])ye[t].min=+opts[`weight_helper_${t}_min`],ye[t].max=+opts[`weight_helper_${t}_max`],ye[t].step=+opts[`weight_helper_${t}_step`]}function T(e){return ye[e]}function we(e){return e in ne?ne[e]:ne[y.Unknown]}function Q(e,t){let o=V(e,t);return ne[e||y.Unknown].filter((r,n)=>o[n]===1)}function V(e,t){return rt[e||y.Unknown][t||S.Unknown]}function N(e,t){return st[e||y.Unknown][t||S.Unknown]}function it(e,t){return nt[e||y.Unknown][t||S.Unknown]}var A={},E={};function O(e){return A[e]??[]}function ee(e,t){t={loraParams:t.loraParams,selectedLoraBlockType:t.selectedLoraBlockType,selectedModelType:t.selectedModelType},e in A?(A[e]=A[e].filter(o=>o.loraParams!==t.loraParams),A[e].push(t)):A[e]=[t]}function lt(e){if(e in A){let t=E[e];A[e]=A[e].filter(o=>t&&t.has(o.loraParams))}}function ct(e,t){e in E?E[e].add(t):E[e]=new Set([t])}function gt(e,t){e in E&&E[e].delete(t)}function U(e,t){return e in E?E[e].has(t):!1}function dt(){localStorage.setItem("wh://histories",JSON.stringify(A));let e={};for(let t in E)e[t]=Array.from(E[t]);localStorage.setItem("wh://locks",JSON.stringify(e))}function pt(){let e=localStorage.getItem("wh://histories");e&&(A=JSON.parse(e));let t=localStorage.getItem("wh://locks");if(t){let o=JSON.parse(t);for(let r in o)E[r]=new Set(o[r])}}function G(e,t,o,r){let n=new Set(Q(e,t)),a=Object.entries(r).filter(([l])=>n.has(l)).map(l=>l[1].value).join(","),s=Object.entries(o).find(([,l])=>l===a);return s?s[0]:""}function Te(e){let t,o=typeof window.TAC_CFG<"u"&&window.TAC_CFG,r,n=typeof window.pilotIsActive<"u"&&window.pilotIsActive;try{o&&(t=window.TAC_CFG.activeIn.global,window.TAC_CFG.activeIn.global=!1),n&&(r=window.pilotIsActive,window.pilotIsActive=!1),e()}finally{o&&(window.TAC_CFG.activeIn.global=t),n&&(window.pilotIsActive=r)}}var ht={},ut={};function ft(e){return ht[e]}function mt(e,t){ht[e]={metadataState:t.metadataState,selectedLoraBlockType:t.weightState.selectedLoraBlockType,selectedModelType:t.weightState.selectedModelType,usingBlocks:t.usingBlocks}}function St(e){return ut[e]}function bt(e,t){ut[e]=t}var yt,wt,Tt,Mt,kt,xt={},vt=0;function se(){return yt}function Lt(e){yt=e}function ae(){return wt}function Ct(e){wt=e}function He(){return Tt}function $t(e){Tt=e}function Re(){return Mt}function Me(e){Mt=e}function _t(){return kt}function Bt(e){kt=e}function ke(){return vt||0}function At(e){vt=+gradioApp().querySelector(`div:is([id^='tab_${e}'][class*='tabitem'])`).querySelector('div:is([id$="_steps"]) input[type=number]').value}function $(e,t){return xt[e||y.Unknown][t||S.Unknown]}function Et(e){let n=(gradioApp().querySelector(`div:is([id^='tab_${e}'][class*='tabitem'])`).querySelector("#lbw_ratiospreset textarea").value??"").split(`
`).filter(s=>s.trim()!==""),a={};for(let s of Object.values(y)){a[s]={};for(let l of Object.values(S)){let i={},g={};a[s][l]=i;let u=V(s,l).filter(c=>c==1).length;for(let c of n){let h=c.split(":");h.length==2&&h[1].split(",").length==u&&(i[h[0]]=h[1],g[h[1]]=h[0])}}}xt=a}var Pt=e=>e.toLowerCase(),z=e=>e?"":"display: none",D=e=>e?"":"visibility: hidden",I=(e,t=void 0)=>{if(e.uiState.isWaiting)return!0;switch(t){case m.TENC:case m.UNET:case m.START:case m.STOP:case void 0:return!1}return e.usingBlocks!==void 0&&!e.usingBlocks.has(t)};function xe(e){let t=[];return e.split(",").map(o=>o.trim()).forEach(o=>{let r=o.match(/^([A-Z]+)(\d+)-\1(\d+)$/);if(!r){t.push(o);return}let[,n,a,s]=r,l=parseInt(a),i=parseInt(s),g=l;for(;t.push(`${n}${g.toString().padStart(2,"0")}`),g!=i;)g+=l<i?1:-1}),t}var wo=/<(lora|lyco):([^:]+):([^>]+)>/;function It(e){let t=e.target;if(!opts.weight_helper_enabled)return;let o=window.getSelection()?.toString();if(o)return;let r=t.value,n=t.selectionStart,a=r.lastIndexOf("<",n-1),s=r.indexOf(">",n);if(a<0||s<0||(o=r.substring(a,s+1),(o.match(/</g)||[]).length!=1||(o.match(/>/g)||[]).length!=1))return;n=a;let l=wo.exec(o);if(l){e.preventDefault();let i=l[1].toLowerCase(),g=l[2],u=l[3],c=t.closest("[id^='tab_'][class*='tabitem']").id.split("_")[1],h=n+l.index,p=h+l.input.trim().length;return{tabId:c,textarea:t,selectionStart:h,selectionEnd:p,namespace:i,loraName:g,loraParams:u,top:e.pageY+15,left:e.pageX}}}function X(e){let t=ae(),o=He(),r=Re();t.value=t.value.substring(0,o)+e+t.value.substring(r),Me(o+e.length)}function To(e){Te(()=>{let t=ae(),o=He(),r=Re();t.focus(),t.setSelectionRange(o,r),document.execCommand("insertText",!1,e)})}function _(e,t){let o=String(t.weights[m.TENC].value),r=0,n=0;for(let p of[m.UNET]){let w=t.weights[p],b=T(p).default,f=+w.value;(w.checkState||w.checkState===void 0&&f!=b)&&(n===r?o+=`:${f}`:o+=`:${Pt(p)}=${f}`,r++),n++}let a=T(m.START).default,s=t.weights[m.START].value,l=T(m.STOP).default,i=t.weights[m.STOP].value;i<0&&(i=T(m.STOP).default),s!=a&&i!=l?o+=`:step=${s}-${i}`:s!=a?o+=`:start=${s}`:i!=l&&(o+=`:stop=${i}`);let{selectedModelType:g,selectedLoraBlockType:u}=t,c=t.xyzMode,h=o;if(c)o+=":lbw=XYZ",h+=":lbw=XYZ";else if(g!==y.Unknown){let p=V(g,u).map((b,f)=>{if(b===1)return t.weights[we(g)[f]]}).filter(b=>b!==void 0),w=T(m.LBW).default;if(!p.every(b=>b.value===w)){let b=p.map(C=>C.value).join(",");o+=`:lbw=${b}`;let f=$(g,u),M=Object.entries(f).find(([,C])=>b===C);M?h+=`:lbw=${M[0]}`:h+=`:lbw=${b}`}}return t.lbwe&&(o+=`:lbwe=${t.lbwe}`,h+=`:lbwe=${t.lbwe}`),{loraParams:o,loraDefine:`<lora:${e}:${h}>`}}function le(e,t=!1){let o=_(e.loraName,e.weightState);opts.weight_helper_using_execCommand?e.srcLoraParams!==o.loraParams&&To(o.loraDefine):t&&X(_t()),mt(e.loraName,e),e.weightState.xyzMode||ee(e.loraName,{loraParams:o.loraParams,...e.weightState}),dt()}var d,ve=[],Le=[];function v(){ve.forEach(e=>e(d))}function Mo(e){Le.forEach(t=>t(e))}function Wt(e){return ve.push(e),()=>{let t=ve.indexOf(e);t>-1&&ve.splice(t,1)}}function Nt(e){return Le.push(e),()=>{let t=Le.indexOf(e);t>-1&&Le.splice(t,1)}}function L(){return d}function Ut(e){d=e,v()}function Dt(e){d=e,v()}function Ot(e){d=e,v()}function Ht(e,t){Mo({top:e,left:t})}function Ce(e){let t={...d,metadataState:{...d.metadataState,algorithm:e.algorithm||"Unknown",baseModel:e.baseModel||"Unknown",modelType:e.modelType||"Unknown"},weightState:{...d.weightState,selectedModelType:e.selectedModelType,weights:e.weights},blockGroups:e.blockGroups,lbwPresets:e.lbwPresets,uiState:{...d.uiState,isWaiting:!1}};e.usingBlocks===null?t.usingBlocks=void 0:e.usingBlocks&&(t.usingBlocks=new Set(e.usingBlocks)),d=t,v()}function ce(e){d={...d,uiState:{...d.uiState,isWaiting:e}},v()}function Ve(e){let t={...d,weightState:{...d.weightState,selectedLoraBlockType:e.selectedLoraBlockType,selectedModelType:e.selectedModelType,weights:e.weights},blockGroups:e.blockGroups,lbwPresets:e.lbwPresets};opts.weight_helper_using_execCommand||X(_(t.loraName,t.weightState).loraDefine),d=t,v()}function Rt(){let e={...d,weightState:{...d.weightState,xyzMode:!d.weightState.xyzMode}};opts.weight_helper_using_execCommand||X(_(e.loraName,e.weightState).loraDefine),d=e,v()}function Vt(e){let t={...d.weightState,weights:{...d.weightState.weights,...e.weights}},o=_(d.loraName,t),r=U(d.loraName,o.loraParams),n={...d,weightState:t,preset:e.preset,lock:r};opts.weight_helper_using_execCommand||X(o.loraDefine),d=n,v()}function Gt(){let e=_(d.loraName,d.weightState).loraParams,t=U(d.loraName,e);t?gt(d.loraName,e):ct(d.loraName,e),d={...d,lock:!t},v()}function Ge(e){let{locked:t,historyIndex:o,preset:r}=e,{selectedLoraBlockType:n,selectedModelType:a,weights:s,lbwe:l,xyzMode:i}=e.weightState,g={...d.weightState,weights:{...d.weightState.weights,...s},selectedLoraBlockType:n,selectedModelType:a,lbwe:l,xyzMode:i},u={...d,historyIndex:o,preset:r,weightState:g,lock:t};opts.weight_helper_using_execCommand||X(_(u.loraName,u.weightState).loraDefine),d=u,v()}function zt(e){d={...d,historyIndex:e},v()}function $e(e){d.weightState.xyzMode=!1;let t={...d.weightState.weights,[e.block]:{...d.weightState.weights[e.block],value:e.value,sliderMin:Math.min(e.value,d.weightState.weights[e.block].sliderMin),sliderMax:Math.max(e.value,d.weightState.weights[e.block].sliderMax),checkState:e.checkState}},o={...d.weightState,weights:t,xyzMode:!1},r=_(d.loraName,o),n=U(d.loraName,r.loraParams),a={...d,weightState:o,preset:G(d.weightState.selectedModelType,d.weightState.selectedLoraBlockType,d.lbwPresets,t),lock:n};opts.weight_helper_using_execCommand||X(r.loraDefine),d=a,v()}function Xt(){d={...d,uiState:{...d.uiState,isMoreButtonVisible:!1}},v()}function Ft(){lt(d.loraName),d.weightState.xyzMode||ee(d.loraName,{loraParams:_(d.loraName,d.weightState).loraParams,...d.weightState});let e=O(d.loraName).length-1;d={...d,historyIndex:e<0?0:e},v()}function Yt(e){d={...d,previewState:e},v()}function ze(e){d={...d,previewState:{...d.previewState,isDescriptionVisible:e}},v()}function jt(){d={...d,previewState:{...d.previewState,isTagInsertButtonVisible:!1}},v()}function _e(){return{loraName:"",metadataState:void 0,srcLoraParams:"",weightState:{selectedLoraBlockType:S.lora,selectedModelType:y.SD,weights:{},lbwe:"",xyzMode:!1},blockGroups:[],usingBlocks:void 0,preset:"",lbwPresets:{},uiState:{isVisible:!1,scale:1,isMoreButtonVisible:!0,isWaiting:!1},lock:!1,historyIndex:0,previewState:{modelId:"",triggerWords:[],negativeTriggerWords:[],modelName:"",thumbUrl:"",hasMetadata:!1,description:"",isDescriptionVisible:!1,isTagInsertButtonVisible:!1}}}function Zt(e,t,o){let r=y.Unknown,n=S.Unknown,a=O(t);if(a&&a.length>0){let p=a[a.length-1];r=p.selectedModelType??y.Unknown,n=p.selectedLoraBlockType??S.Unknown}let s,l,i=ft(t);i&&(s=i.metadataState,r=i.selectedModelType??y.Unknown,n=i.selectedLoraBlockType??S.Unknown,l=i.usingBlocks);let g=ko(e,o,r,n),u=$(g.selectedModelType,g.selectedLoraBlockType),c=_(t,g).loraParams,h=!1;for(let p of[m.UNET,m.START,m.STOP]){let w=g.weights[p],b=T(p).default,f=+w.value;if(!(w.checkState||w.checkState===void 0&&f!=b)){h=!0;break}}return{loraName:t,metadataState:s,srcLoraParams:c,weightState:g,blockGroups:N(g.selectedModelType,g.selectedLoraBlockType),usingBlocks:l,uiState:{isVisible:!0,scale:opts.weight_helper_context_menu_scale,isMoreButtonVisible:h,isWaiting:!s},previewState:xo(t),preset:G(g.selectedModelType,g.selectedLoraBlockType,u,g.weights),lbwPresets:u,lock:U(t,c),historyIndex:a.length-1}}function ko(e,t,o,r){let n=Be(t,o,r),{weights:a,lbwe:s,xyzMode:l}=n;return r===S.Unknown&&(r=e==="lora"?S.lora:S.lycoris),{selectedLoraBlockType:r,selectedModelType:o,weights:a,lbwe:s,xyzMode:l}}function Be(e,t,o){let r=e.split(":"),n={};for(let b=0;b<r.length;b++){let f,M;if(r[b].indexOf("=")>=0){let C=r[b].split("=");f=C[0].toLowerCase(),M=C[1]}else f=[P.te,P.unet][b],M=r[b];n[f]=M}let a=[];for(let b of Object.values(K))for(let f of Object.values(J))a.push({modelType:b,loraBlockType:f,presets:$(b,f),masks:V(b,f)});let s=T(m.TENC).default,l,i=T(m.START).default,g=T(m.STOP).default,u=[],c="",h=!1;Object.entries(n).forEach(([b,f])=>{switch(b){case P.lbw:if(f==="XYZ"){h=!0;break}let M=f.split(",");for(let W of a){if(M.length===1)if(f in W.presets)M=W.presets[f].split(",");else continue;if(M.length===W.masks.filter(q=>q==1).length){t=W.modelType,o=W.loraBlockType;let q=0;for(let Ue of W.masks)Ue?(u.push(+M[q]),q++):u.push(0);break}}break;case P.step:let C=f.split("-");i=Math.round(+C[0]),g=Math.round(+C[1]);break;case P.lbwe:c=f;break;case P.te:s=+f;break;case P.unet:l=+f;break;case P.start:i=Math.round(+f);break;case P.stop:g=Math.round(+f);break}});let p=!0;l===void 0&&(l=T(m.UNET).default,p=!1);let w={};if(t!==y.Unknown){let b=we(t);if(u.length===0)for(let f=0;f<b.length;f++)u.push(T(m.LBW).default);u.forEach((f,M)=>{w[b[M]]={initValue:f,value:f,sliderMin:Math.min(f,T(m.LBW).min),sliderMax:Math.max(f,T(m.LBW).max)}})}return{selectedLoraBlockType:o,selectedModelType:t,weights:{[m.TENC]:{initValue:s,value:s,sliderMin:Math.min(s,T(m.TENC).min),sliderMax:Math.max(s,T(m.TENC).max)},[m.UNET]:{initValue:l,value:l,sliderMin:Math.min(l,T(m.UNET).min),sliderMax:Math.max(l,T(m.UNET).max),initCheckState:p,checkState:p},[m.START]:{initValue:i,value:i,sliderMin:Math.min(i,T(m.START).min),sliderMax:Math.max(i,T(m.START).max)},[m.STOP]:{initValue:g,value:g,sliderMin:Math.min(g,T(m.STOP).min),sliderMax:Math.max(g,T(m.STOP).max)},...w},lbwe:c,xyzMode:h}}function xo(e){let t=St(e);return t||{modelId:"",triggerWords:[""],negativeTriggerWords:[""],modelName:"",thumbUrl:be,hasMetadata:!1,description:"",isDescriptionVisible:!1,isTagInsertButtonVisible:!1}}var Ae=null,Ee=null;function Pe(){return Ae&&Ae.abort(),Ae=new AbortController,Ae}function qt(){return Ee&&Ee.abort(),Ee=new AbortController,Ee}async function Ie(e,t,o){let r=await fetch(`/whapi/v1/get_metadata?key=${encodeURIComponent(e)}&force=${t}`,{method:"POST",signal:o});if(!r.ok)throw new Error(`Failed to set up API endpoints. Please reload the page.: ${r.status}`);return await r.json()}async function Kt(e,t){let o=await fetch(`/whapi/v1/get_preview_info?key=${encodeURIComponent(e)}`,{method:"POST",signal:t});if(!o.ok)throw new Error(`Failed to set up API endpoints. Please reload the page.: ${o.status}`);return{...await o.json(),isDescriptionVisible:!1,isTagInsertButtonVisible:!0}}function F(e,t){let o={...e},r=[];return t.forEach(n=>{n.forEach(a=>{xe(a).forEach(l=>{r.includes(l)||r.push(l)})})}),r.forEach(n=>{o[n]||(o[n]={initValue:T(m.LBW).default,value:T(m.LBW).default,sliderMin:T(m.LBW).min,sliderMax:T(m.LBW).max})}),o}var Ke=globalThis,We=Ke.trustedTypes,Jt=We?We.createPolicy("lit-html",{createHTML:e=>e}):void 0,no="$lit$",R=`lit$${Math.random().toFixed(9).slice(2)}$`,so="?"+R,vo=`<${so}>`,Z=document,de=()=>Z.createComment(""),pe=e=>e===null||typeof e!="object"&&typeof e!="function",Je=Array.isArray,Lo=e=>Je(e)||typeof e?.[Symbol.iterator]=="function",Xe=`[ 	
\f\r]`,ge=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Qt=/-->/g,eo=/>/g,Y=RegExp(`>|${Xe}(?:([^\\s"'>=/]+)(${Xe}*=${Xe}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),to=/'/g,oo=/"/g,ao=/^(?:script|style|textarea|title)$/i,Qe=e=>(t,...o)=>({_$litType$:e,strings:t,values:o}),k=Qe(1),rr=Qe(2),nr=Qe(3),he=Symbol.for("lit-noChange"),x=Symbol.for("lit-nothing"),ro=new WeakMap,j=Z.createTreeWalker(Z,129);function io(e,t){if(!Je(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Jt!==void 0?Jt.createHTML(t):t}var Co=(e,t)=>{let o=e.length-1,r=[],n,a=t===2?"<svg>":t===3?"<math>":"",s=ge;for(let l=0;l<o;l++){let i=e[l],g,u,c=-1,h=0;for(;h<i.length&&(s.lastIndex=h,u=s.exec(i),u!==null);)h=s.lastIndex,s===ge?u[1]==="!--"?s=Qt:u[1]!==void 0?s=eo:u[2]!==void 0?(ao.test(u[2])&&(n=RegExp("</"+u[2],"g")),s=Y):u[3]!==void 0&&(s=Y):s===Y?u[0]===">"?(s=n??ge,c=-1):u[1]===void 0?c=-2:(c=s.lastIndex-u[2].length,g=u[1],s=u[3]===void 0?Y:u[3]==='"'?oo:to):s===oo||s===to?s=Y:s===Qt||s===eo?s=ge:(s=Y,n=void 0);let p=s===Y&&e[l+1].startsWith("/>")?" ":"";a+=s===ge?i+vo:c>=0?(r.push(g),i.slice(0,c)+no+i.slice(c)+R+p):i+R+(c===-2?l:p)}return[io(e,a+(e[o]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),r]},ue=class e{constructor({strings:t,_$litType$:o},r){let n;this.parts=[];let a=0,s=0,l=t.length-1,i=this.parts,[g,u]=Co(t,o);if(this.el=e.createElement(g,r),j.currentNode=this.el.content,o===2||o===3){let c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(n=j.nextNode())!==null&&i.length<l;){if(n.nodeType===1){if(n.hasAttributes())for(let c of n.getAttributeNames())if(c.endsWith(no)){let h=u[s++],p=n.getAttribute(c).split(R),w=/([.?@])?(.*)/.exec(h);i.push({type:1,index:a,name:w[2],strings:p,ctor:w[1]==="."?Ye:w[1]==="?"?je:w[1]==="@"?Ze:re}),n.removeAttribute(c)}else c.startsWith(R)&&(i.push({type:6,index:a}),n.removeAttribute(c));if(ao.test(n.tagName)){let c=n.textContent.split(R),h=c.length-1;if(h>0){n.textContent=We?We.emptyScript:"";for(let p=0;p<h;p++)n.append(c[p],de()),j.nextNode(),i.push({type:2,index:++a});n.append(c[h],de())}}}else if(n.nodeType===8)if(n.data===so)i.push({type:2,index:a});else{let c=-1;for(;(c=n.data.indexOf(R,c+1))!==-1;)i.push({type:7,index:a}),c+=R.length-1}a++}}static createElement(t,o){let r=Z.createElement("template");return r.innerHTML=t,r}};function oe(e,t,o=e,r){if(t===he)return t;let n=r!==void 0?o._$Co?.[r]:o._$Cl,a=pe(t)?void 0:t._$litDirective$;return n?.constructor!==a&&(n?._$AO?.(!1),a===void 0?n=void 0:(n=new a(e),n._$AT(e,o,r)),r!==void 0?(o._$Co??=[])[r]=n:o._$Cl=n),n!==void 0&&(t=oe(e,n._$AS(e,t.values),n,r)),t}var Fe=class{constructor(t,o){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=o}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){let{el:{content:o},parts:r}=this._$AD,n=(t?.creationScope??Z).importNode(o,!0);j.currentNode=n;let a=j.nextNode(),s=0,l=0,i=r[0];for(;i!==void 0;){if(s===i.index){let g;i.type===2?g=new fe(a,a.nextSibling,this,t):i.type===1?g=new i.ctor(a,i.name,i.strings,this,t):i.type===6&&(g=new qe(a,this,t)),this._$AV.push(g),i=r[++l]}s!==i?.index&&(a=j.nextNode(),s++)}return j.currentNode=Z,n}p(t){let o=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,o),o+=r.strings.length-2):r._$AI(t[o])),o++}},fe=class e{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,o,r,n){this.type=2,this._$AH=x,this._$AN=void 0,this._$AA=t,this._$AB=o,this._$AM=r,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode,o=this._$AM;return o!==void 0&&t?.nodeType===11&&(t=o.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,o=this){t=oe(this,t,o),pe(t)?t===x||t==null||t===""?(this._$AH!==x&&this._$AR(),this._$AH=x):t!==this._$AH&&t!==he&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Lo(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==x&&pe(this._$AH)?this._$AA.nextSibling.data=t:this.T(Z.createTextNode(t)),this._$AH=t}$(t){let{values:o,_$litType$:r}=t,n=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=ue.createElement(io(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===n)this._$AH.p(o);else{let a=new Fe(n,this),s=a.u(this.options);a.p(o),this.T(s),this._$AH=a}}_$AC(t){let o=ro.get(t.strings);return o===void 0&&ro.set(t.strings,o=new ue(t)),o}k(t){Je(this._$AH)||(this._$AH=[],this._$AR());let o=this._$AH,r,n=0;for(let a of t)n===o.length?o.push(r=new e(this.O(de()),this.O(de()),this,this.options)):r=o[n],r._$AI(a),n++;n<o.length&&(this._$AR(r&&r._$AB.nextSibling,n),o.length=n)}_$AR(t=this._$AA.nextSibling,o){for(this._$AP?.(!1,!0,o);t!==this._$AB;){let r=t.nextSibling;t.remove(),t=r}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}},re=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,o,r,n,a){this.type=1,this._$AH=x,this._$AN=void 0,this.element=t,this.name=o,this._$AM=n,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=x}_$AI(t,o=this,r,n){let a=this.strings,s=!1;if(a===void 0)t=oe(this,t,o,0),s=!pe(t)||t!==this._$AH&&t!==he,s&&(this._$AH=t);else{let l=t,i,g;for(t=a[0],i=0;i<a.length-1;i++)g=oe(this,l[r+i],o,i),g===he&&(g=this._$AH[i]),s||=!pe(g)||g!==this._$AH[i],g===x?t=x:t!==x&&(t+=(g??"")+a[i+1]),this._$AH[i]=g}s&&!n&&this.j(t)}j(t){t===x?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}},Ye=class extends re{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===x?void 0:t}},je=class extends re{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==x)}},Ze=class extends re{constructor(t,o,r,n,a){super(t,o,r,n,a),this.type=5}_$AI(t,o=this){if((t=oe(this,t,o,0)??x)===he)return;let r=this._$AH,n=t===x&&r!==x||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,a=t!==x&&(r===x||n);n&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}},qe=class{constructor(t,o,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=o,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){oe(this,t)}};var $o=Ke.litHtmlPolyfillSupport;$o?.(ue,fe),(Ke.litHtmlVersions??=[]).push("3.3.1");var et=(e,t,o)=>{let r=o?.renderBefore??t,n=r._$litPart$;if(n===void 0){let a=o?.renderBefore??null;r._$litPart$=n=new fe(t.insertBefore(de(),a),a,void 0,o??{})}return n._$AI(e),n};function me(e,t){let o=L(),r=T(e)??T(m.LBW),n=u=>{let c=u.target;$e({block:e,value:o.weightState.weights[e].value,checkState:c.checked})},a=u=>{let h=+u.target.value/100,p=o.weightState.weights[e].checkState;p!==void 0&&(p=!0),$e({block:e,value:h,checkState:p})},s=u=>{let h=+u.target.value,p=o.weightState.weights[e].checkState;p!==void 0&&(p=!0),$e({block:e,value:h,checkState:p})},l=t[e],i=u=>{let c=u.target,h=+c.value/100,w=c.parentElement.querySelector("input.value");w&&(w.value=h.toString())},g=u=>{let c=u.target,p=c.parentElement.querySelector("input.slider");if(!p)return;let w=+c.value;if(isNaN(w))return;let b=+p.min,f=+p.max,M=Math.round(w*100);M<b&&(b=M),M>f&&(f=M),b!==+p.min&&(p.min=String(b)),f!==+p.max&&(p.max=String(f)),p.value=String(M)};return k`
        <span>
            <label>${e}</label>
            ${o.weightState.weights[e].checkState!==void 0?k`<input type="checkbox" .checked=${o.weightState.weights[e].checkState} @input=${n} />`:""}
        </span>
        <div class="f f-c g-4">
            <input
                class="slider"
                type="range"
                .min=${Math.round(l.sliderMin*100)}
                .max=${Math.round(l.sliderMax*100)}
                .step=${Math.round(r.step*100)}
                .value=${Math.round(l.value*100)}
                ?disabled=${I(o,e)}
                @input=${i}
                @change=${a}
            />
            <input
                class="value"
                type="number"
                .value=${+l.value}
                .step=${r.step}
                ?disabled=${I(o,e)}
                @input=${g}
                @change=${s}
            />
        </div>
    `}var tt=!1,ot={x:0,y:0};function lo(e,t){let o=L(),r=O(o.loraName),n=c=>{tt=!0;let h=document.getElementById("weight-helper");if(!h)return;let p=h.getBoundingClientRect();ot={x:c.clientX-p.left,y:c.clientY-p.top},document.addEventListener("mousemove",a),document.addEventListener("mouseup",s)},a=c=>{if(!tt)return;let h=c.clientX-ot.x+window.scrollX,p=c.clientY-ot.y+window.scrollY;Ht(p,h)},s=()=>{tt=!1,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",s)},l=()=>{Ft()},i=()=>{Gt()},g=()=>{let c=Math.max(0,o.historyIndex-1),h=r[c],p=Be(h.loraParams,h.selectedModelType,h.selectedLoraBlockType),w=U(o.loraName,h.loraParams),b=G(h.selectedModelType,h.selectedLoraBlockType,o.lbwPresets,p.weights);Ge({historyIndex:c,weightState:p,locked:w,preset:b})},u=()=>{let c=Math.min(r.length-1,o.historyIndex+1),h=r[c],p=Be(h.loraParams,h.selectedModelType,h.selectedLoraBlockType),w=U(o.loraName,h.loraParams),b=G(h.selectedModelType,h.selectedLoraBlockType,o.lbwPresets,p.weights);Ge({historyIndex:c,weightState:p,locked:w,preset:b})};return k`
        <header @mousedown=${n}>
            <span>
                <span class="lock ${t?"like":"unlike"}" style="${D(!o.weightState.xyzMode)}" @click=${i}>
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path
                            d="M21,10H19V7A7,7,0,0,0,5,7v3H3a1,1,0,0,0-1,1v9a4,4,0,0,0,4,4H18a4,4,0,0,0,4-4V11A1,1,0,0,0,21,10Zm-9,9.5A2.5,2.5,0,1,1,14.5,17,2.5,2.5,0,0,1,12,19.5ZM15,10H9V7a3,3,0,0,1,6,0v3Z"
                        ></path>
                    </svg>
                </span>
                <label class="name">${e}</label>
            </span>
            <div class="history" style="${z(r.length>1)}">
                <a class="icon" @click=${l}>clear</a>
                <div class="page">
                    <a class="icon" @click=${g} style="${D(o.historyIndex>0)}">&lt;</a>
                    <label class="page-label">${o.historyIndex+1}/${r.length}</label>
                    <a class="icon" @click=${u} style="${D(o.historyIndex<r.length-1)}">&gt;</a>
                </div>
            </div>
        </header>
    `}function co(){let e=L(),{blockGroups:t,weightState:o}=e,{selectedModelType:r,selectedLoraBlockType:n}=o,a=new Set(Q(r,n));return k`
        <div class="lbw-column">
            ${t.map(s=>k`
                    <div class="f col g-2" style="display: flex">
                        ${s.map(l=>k`
                                <div class="border p f g-2 col">
                                    ${xe(l).map(i=>a.has(i)&&o.weights[i]?k` <div class="f g-2">${me(i,o.weights)}</div> `:"")}
                                </div>
                            `)}
                    </div>
                `)}
        </div>
    `}function go(){let e=L(),t=a=>{let l=a.target.value,i=N(e.weightState.selectedModelType,l),g=$(e.weightState.selectedModelType,l),u=F(e.weightState.weights,i);Ve({selectedLoraBlockType:l,selectedModelType:e.weightState.selectedModelType,blockGroups:i,lbwPresets:g,weights:u})},o=a=>{let l=a.target.value,i=N(l,e.weightState.selectedLoraBlockType),g=$(l,e.weightState.selectedLoraBlockType),u=F(e.weightState.weights,i);Ve({selectedModelType:l,selectedLoraBlockType:e.weightState.selectedLoraBlockType,blockGroups:i,lbwPresets:g,weights:u})},r=()=>{Rt()},n=a=>{let s=a.target,l=s.value;if(l===""&&(l=e.preset,l===""))return;let i=$(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType)[l].split(",").map(c=>+c),g={};Q(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType).forEach((c,h)=>{g[c]={initValue:e.weightState.weights[c].initValue,value:i[h],sliderMin:Math.min(i[h],e.weightState.weights[c].sliderMin),sliderMax:Math.max(i[h],e.weightState.weights[c].sliderMax)}}),Vt({weights:g,preset:s.value})};return k`
        <div class="f g-2 f-end">
            <select .value="${e.weightState.selectedModelType}" style="flex-grow: 1" ?disabled="${I(e)}" @change="${o}">
                ${Object.entries(K).map(([a,s])=>k` <option value="${s}">${a}</option> `)}
            </select>
            <select
                .value="${e.weightState.selectedLoraBlockType}"
                style="flex-grow: 1"
                ?disabled="${I(e)}"
                @change="${t}"
            >
                ${Object.entries(J).map(([a,s])=>k` <option value="${s}">${a}</option> `)}
            </select>
        </div>
        <div class="f g-2 f-end">
            <select .value="${e.preset}" style="flex-grow: 1" ?disabled="${I(e)}" @change="${n}">
                <option value=""></option>
                ${Object.keys(e.lbwPresets).map(a=>k` <option value="${a}">${a}</option> `)}
            </select>
            <div class="p f g-2 f-end">
                <div class="f g-2 f-end">
                    <input
                        id="wh:xyz"
                        value="XYZ"
                        type="checkbox"
                        .checked="${e.weightState.xyzMode}"
                        ?disabled="${I(e)}"
                        @change="${r}"
                    />
                    <label class="radio-label" for="wh:xyz">
                        ${it(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType)}
                    </label>
                </div>
            </div>
        </div>
    `}function po(){let e=L(),t=()=>{if(e.uiState.isWaiting)return;let o=Pe();ce(!0),Ie(e.loraName,!0,o.signal).then(r=>{let n=e.weightState.selectedModelType;(!n||n===y.Unknown)&&(n=r.modelType??y.Unknown);let a=N(n,e.weightState.selectedLoraBlockType),s=F(e.weightState.weights,a);Ce({algorithm:r.algorithm||"Unknown",modelType:r.modelType||"Unknown",baseModel:r.baseModel||"Unknown",selectedModelType:n,usingBlocks:r.usingBlocks,blockGroups:a,lbwPresets:$(n,e.weightState.selectedLoraBlockType),weights:s})}).catch(r=>{r.name!=="AbortError"&&(console.error("Error fetching metadata:",r),ce(!1))})};return k`
        <span class="metadata">
            <span>
                <span>Model</span>
                <span>${e.metadataState?.modelType||"Unknown"}</span>
            </span>
            <span>
                <span>Base</span>
                <span>${e.metadataState?.baseModel||"Unknown"}</span>
            </span>
            <a class="icon mini svg" @click=${t}>
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492 492">
                    <g>
                        <path
                            d="M484.08,296.216c-5.1-5.128-11.848-7.936-19.032-7.936H330.516c-14.828,0-26.86,12.036-26.86,26.868v22.796c0,7.168,2.784,14.064,7.884,19.16c5.092,5.088,11.82,8.052,18.976,8.052H366.1c-31.544,30.752-74.928,50.08-120.388,50.08c-71.832,0-136.028-45.596-159.744-113.344c-5.392-15.404-19.972-25.784-36.28-25.784c-4.316,0-8.592,0.708-12.7,2.144c-9.692,3.396-17.48,10.352-21.932,19.596c-4.456,9.248-5.04,19.684-1.648,29.368c34.496,98.54,127.692,164.74,232.144,164.74c64.132,0,123.448-23.948,169.572-67.656v25.22c0,14.836,12.384,27.108,27.224,27.108h22.792c14.84,0,26.86-12.272,26.86-27.108V315.24C492,308.056,489.2,301.304,484.08,296.216z"
                        ></path>
                    </g>
                    <g>
                        <path
                            d="M478.628,164.78C444.132,66.244,350.916,0.044,246.464,0.044c-64.136,0-123.464,23.952-169.588,67.66v-25.22c0-14.832-12.344-27.112-27.184-27.112H26.896C12.06,15.372,0,27.652,0,42.484V176.76c0,7.18,2.824,13.868,7.944,18.964c5.096,5.128,11.86,7.932,19.044,7.932l-0.08,0.06h134.604c14.84,0,26.832-12.028,26.832-26.86v-22.8c0-14.836-11.992-27.216-26.832-27.216h-35.576c31.544-30.752,74.932-50.076,120.392-50.076c71.832,0,136.024,45.596,159.74,113.348c5.392,15.404,19.968,25.78,36.28,25.78c4.32,0,8.588-0.704,12.7-2.144c9.696-3.396,17.48-10.348,21.932-19.596C481.432,184.9,482.02,174.472,478.628,164.78z"
                        ></path>
                    </g>
                </svg>
            </a>
        </span>
    `}function ho(e){let t=i=>{extraNetworksRequestMetadata(i,"lora",e.modelName)},o=i=>{extraNetworksEditUserMetadata(i,se(),"lora",e.modelName)},r=()=>{window.open(`https://civitai.com/models/${e.modelId}`,"_blank")},n=()=>{ze(!0)},a=()=>{ze(!1)},s=()=>{let i=se(),g=document.querySelector(`#${i}_prompt textarea`),u=document.querySelector(`#${i}_neg_prompt textarea`),c=ae();if(c===u||c!==g&&(g=c,u=void 0),!opts.weight_helper_using_execCommand)(()=>{let p=[{triggerWords:e.triggerWords,textarea:g},{triggerWords:e.negativeTriggerWords,textarea:u}];for(let{triggerWords:w,textarea:b}of p)if(w.length>0&&b){let f=w.join(", ");b.value&&(f=", "+f),b.value+=f}})();else{let h=()=>{let p=[{triggerWords:e.triggerWords,textarea:g},{triggerWords:e.negativeTriggerWords,textarea:u}];for(let{triggerWords:w,textarea:b}of p)if(w.length>0&&b){let f=w.join(", ");b.value&&(f=", "+f),b.focus();let M=b.value.length;b.setSelectionRange(M,M),document.execCommand("insertText",!1,f)}};Te(()=>{h()})}jt()},l=["preview-pane","card"];switch(opts.weight_helper_preview_position){case"Bottom Right":l.push("preview-bottom-right");break;case"Top Left":l.push("preview-top-left");break;case"Bottom Left":l.push("preview-bottom-left");break;default:l.push("preview-top-right");break}return k`
        <div class="${l.join(" ")}" data-name="${e.modelName}">
            <img class="preview" src="${e.thumbUrl}" style="height: ${opts.weight_helper_preview_height}px" />
            <div class="action-row button-top" style="${D(!e.isDescriptionVisible)}">
                ${e.modelName&&e.hasMetadata&&typeof extraNetworksRequestMetadata=="function"?k` <div class="metadata-btn card-btn" title="Show internal metadata" @click="${t}"></div> `:""}
                ${e.modelName&&typeof extraNetworksEditUserMetadata=="function"?k` <div class="edit-btn card-btn" title="Edit metadata" @click="${o}"></div> `:""}
                ${e.modelId?k` <div class="civitai-btn card-btn" title="Open civitai" @click="${r}"></div> `:""}
                ${e.triggerWords.length>0||e.negativeTriggerWords.length>0?k`
                          <div
                              class="add-trigger-btn card-btn"
                              title="Add trigger words"
                              @click="${s}"
                              style="${z(e.isTagInsertButtonVisible)}"
                          ></div>
                      `:""}
            </div>

            ${e.description?k`
                      <div class="action-row button-bottom" style="${D(!e.isDescriptionVisible)}">
                          <div class="card-btn note-btn" @click="${n}"></div>
                      </div>
                      <textarea class="description" style="${D(e.isDescriptionVisible)}">
                    ${e.description}
                </textarea
                      >
                      <div
                          class="card-btn description-close-btn"
                          style="${D(e.isDescriptionVisible)}"
                          @click="${a}"
                      ></div>
                  `:""}
        </div>
    `}var uo=!1;function fo(){let e=L(),{uiState:t,weightState:o,lock:r}=e;uo||(_o(),uo=!0);let n=`transform: scale(${t.scale}); ${z(t.isVisible)}`;return k`
        <div id="weight-helper" class="${e.uiState.isWaiting?"waiting":""}" style="${n}">
            ${lo(e.loraName,r)} ${po()}
            ${o.weights[m.TENC]&&k`<section class="border p">${me(m.TENC,o.weights)}</section>`}
            ${[m.UNET,m.START,m.STOP].filter(a=>!!o.weights[a]).map(a=>k`<section
                            class="border p"
                            style="${z(!t.isMoreButtonVisible||o.weights[a].initCheckState||o.weights[a].initValue!==T(a).default)}"
                        >
                            ${me(a,o.weights)}
                        </section>`)}

            <button style="${t.isMoreButtonVisible?"":"display: none"}" ?disabled="${I(e)}" @click="${()=>Xt()}">
                show more options
            </button>

            <section class="border p">
                <label>LBW</label>
                <div class="f col g-4 w-fill">${go()} ${co()}</div>
            </section>

            ${e.previewState.modelName?ho(e.previewState):""}
        </div>
    `}function _o(){let e=()=>{let s=L();s.uiState.isVisible&&(Se(),le(s))},t=s=>{let l=L();if(l.uiState.isVisible){s.preventDefault(),Se(),le(l);return}let i=It(s);i&&(s.preventDefault(),Bo(i))},o=s=>{let l=L();if(l.uiState.isVisible){let i=document.getElementById("weight-helper");if(!i)return;let g=se();if(s){let u=s.target;if(i.contains(u)||u.id===`${g}_token_button`||u.id===`${g}_lora_edit_user_metadata_button`||u.className==="global-popup-close")return;if(u.id.indexOf("_interrupt")>0){Se();return}}Se(),le(l)}},r=s=>{if(s.key==="Escape"){let l=L();Ao(l)}};gradioApp().querySelectorAll("button:is([id*='_generate'])").forEach(s=>{s.addEventListener("click",e,!0)}),gradioApp().querySelectorAll("*:is([id*='_toprow'] [id*='_prompt'], .prompt) textarea").forEach(s=>{s.addEventListener("contextmenu",t)}),document.addEventListener("click",o),document.addEventListener("keyup",r)}var mo=!1;function So(e){et(fo(),e),mo||(Wt(()=>{et(fo(),e)}),Nt(t=>{let o=e.querySelector("#weight-helper");o&&(o.style.top=t.top+"px",o.style.left=t.left+"px")}),mo=!0)}function Bo(e){let{tabId:t,textarea:o,selectionStart:r,selectionEnd:n,namespace:a,loraName:s,loraParams:l,top:i,left:g}=e;Lt(t),Ct(o),$t(r),Me(n),Bt(o.value.substring(r,n)),At(t),Et(t),T(m.START).max=ke(),T(m.STOP).max=ke(),T(m.STOP).default=ke();let u=document.getElementById("weight-helper").getBoundingClientRect(),c=window.innerHeight-u.bottom,h=i;c<0&&(u.top<0?h=window.scrollY:h+=c);let p=Zt(a,s,l);Dt(p);let w=document.getElementById("weight-helper");if(w&&(w.style.top=h+"px",w.style.left=g+"px"),!p.metadataState){let b=Pe();Ie(s,!1,b.signal).then(f=>{let M=p.weightState.selectedModelType;(!M||M===y.Unknown)&&(M=f.modelType??y.Unknown);let C=p.weightState.selectedLoraBlockType,W=N(M,C),q=F(p.weightState.weights,W),Ue={...p.weightState,selectedModelType:M,selectedLoraBlockType:C},bo=_(p.loraName,Ue).loraParams;p.weightState.xyzMode||(ee(s,{loraParams:bo,selectedLoraBlockType:C,selectedModelType:M}),zt(O(s).length-1)),Ce({algorithm:f.algorithm||"Unknown",modelType:f.modelType||"Unknown",baseModel:f.baseModel||"Unknown",selectedModelType:M,usingBlocks:f.usingBlocks,blockGroups:W,lbwPresets:$(M,p.weightState.selectedLoraBlockType),weights:q})}).catch(f=>{f.name!=="AbortError"&&(console.error("Error fetching metadata:",f),ce(!1))})}if(!p.previewState.modelId){let b=qt();Kt(s,b.signal).then(async f=>{f.thumbUrl!==be&&(f.thumbUrl=f.thumbUrl),bt(s,f),Yt(f)}).catch(f=>{f.name!=="AbortError"&&console.error("Error fetching metadata:",f)})}}function Se(){let e=_e();Ot(e)}function Ao(e){opts.weight_helper_using_execCommand||le(e,!0),Se()}var Ne,Eo=new Promise(e=>{Ne=e});pt();onUiLoaded(()=>{if(!gradioApp().querySelector("#lbw_ratiospreset"))return;let o=[...getComputedStyle(document.documentElement).getPropertyValue("--body-text-color").trim().slice(1).match(/.{1,2}/g).map(r=>parseInt(r,16)),.3];document.documentElement.style.setProperty("--weight-helper-shadow",`rgba(${o.join(",")})`),document.documentElement.style.setProperty("--weight-helper-slider_size",String(opts.weight_helper_slider_length)),Eo.then(()=>{let r=document.createElement("div");r.id="weight-helper-container",gradioApp().appendChild(r),at(),Ut(_e()),So(r)})});onOptionsChanged(()=>{Ne&&(Ne(!0),Ne=null)});})();
/*! Bundled license information:

lit-html/lit-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/
//# sourceMappingURL=weight_helper.js.map
