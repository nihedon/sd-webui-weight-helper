"use strict";(()=>{var w={lora:"lora",lycoris:"lycoris",Unknown:"Unknown"},v={SD:"SD",SDXL:"SDXL",Flux:"Flux",Unknown:"Unknown"},O={te:"te",unet:"unet",dyn:"dyn",start:"start",stop:"stop",step:"step",lbw:"lbw",lbwe:"lbwe"},m={TENC:"TEnc",UNET:"UNet",DYN:"Dyn",START:"Start",STOP:"Stop",LBW:"LBW"};var Ye={STABLE_DIFFUSION:["BASE","IN00","IN01","IN02","IN03","IN04","IN05","IN06","IN07","IN08","IN09","IN10","IN11","M00","OUT00","OUT01","OUT02","OUT03","OUT04","OUT05","OUT06","OUT07","OUT08","OUT09","OUT10","OUT11"],BLACK_FOREST_LABS:["FL00","FL01","FL02","FL03","FL04","FL05","FL06","FL07","FL08","FL09","FL10","FL11","FL12","FL13","FL14","FL15","FL16","FL17","FL18"]},pe={[v.SD]:Ye.STABLE_DIFFUSION,[v.SDXL]:Ye.STABLE_DIFFUSION,[v.Flux]:Ye.BLACK_FOREST_LABS,[v.Unknown]:[]},pt={[v.SD]:{[w.lora]:[1,0,1,1,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1],[w.lycoris]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[w.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[v.SDXL]:{[w.lora]:[1,0,0,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0],[w.lycoris]:[1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[w.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[v.Flux]:{[w.lora]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[w.lycoris]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[w.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[v.Unknown]:{[w.lora]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[w.lycoris]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[w.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Uo={[v.SD]:{[w.lora]:"XYZ(17)",[w.lycoris]:"XYZ(26)",[w.Unknown]:"XYZ(26)"},[v.SDXL]:{[w.lora]:"XYZ(12)",[w.lycoris]:"XYZ(20)",[w.Unknown]:"XYZ(26)"},[v.Flux]:{[w.lora]:"XYZ(19)",[w.lycoris]:"XYZ(19)",[w.Unknown]:"XYZ(19)"},[v.Unknown]:{[w.lora]:"XYZ(17)",[w.lycoris]:"XYZ(26)",[w.Unknown]:"XYZ(26)"}},ee={"":v.Unknown,SD:v.SD,SDXL:v.SDXL,Flux:v.Flux},te={"":w.Unknown,"LoRA(LierLa)":w.lora,"LyCORIS,etc":w.lycoris},ve="./file=html/card-no-preview.png";var be={[m.TENC]:{min:0,max:0,default:1,step:.5},[m.UNET]:{min:0,max:0,default:0,step:.5},[m.DYN]:{min:0,max:0,default:0,step:.5},[m.START]:{min:0,max:0,default:0,step:1},[m.STOP]:{min:0,max:0,default:0,step:1},[m.LBW]:{min:0,max:0,default:1,step:.5}},ut={[v.SD]:{[w.lora]:["BASE","IN01-IN04","IN05-IN08","M00","OUT03-OUT06","OUT07-OUT11"],[w.lycoris]:["BASE","IN00-IN05","IN06-IN11","M00","OUT00-OUT05","OUT06-OUT11"],[w.Unknown]:[]},[v.SDXL]:{[w.lora]:["BASE","IN04-IN08","M00","OUT00-OUT05"],[w.lycoris]:["BASE","IN00-IN03","IN04-IN08","M00","OUT00-OUT03","OUT04-OUT08"],[w.Unknown]:[]},[v.Flux]:{[w.lora]:["FL00-FL03","FL04-FL07","FL08-FL10","FL11-FL14","FL15-FL18"],[w.lycoris]:["FL00-FL03","FL04-FL07","FL08-FL10","FL11-FL14","FL15-FL18"],[w.Unknown]:[]},[v.Unknown]:{[w.lora]:[],[w.lycoris]:[],[w.Unknown]:[]}};function dt(){let e=/((BASE|MID|M00|(IN|OUT|FL)[0-9]{2}(-(IN|OUT|FL)[0-9]{2})?) *(, *|$))+/;for(let t of Object.values(ee))if(t!==v.Unknown){for(let o of Object.values(te))if(o!==w.Unknown)try{let n=window.opts[`weight_helper_LBW_${t}_${o}_block_points`];if(n=n.replace("MID","M00"),e.exec(n)){let r=n.split(",").map(a=>a.trim().replace(/\d+/g,i=>i.length===1?`0${i}`:i));ut[t][o]=r}}catch(n){console.warn(`${t}_${o} block definition format is invalid.`,n)}}for(let t of[m.TENC,m.UNET,m.DYN,m.LBW])be[t].min=+window.opts[`weight_helper_${t}_min`],be[t].max=+window.opts[`weight_helper_${t}_max`],be[t].step=+window.opts[`weight_helper_${t}_step`]}function k(e){return be[e]}function ke(e){return e in pe?pe[e]:pe[v.Unknown]}function oe(e,t){let o=j(e,t);return pe[e||v.Unknown].filter((n,r)=>o[r]===1)}function j(e,t){return pt[e||v.Unknown][t||w.Unknown]}function V(e,t){return ut[e||v.Unknown][t||w.Unknown]}var U={},R={};function X(e){return U[e]??[]}function ne(e,t){t={loraParams:t.loraParams,selectedLoraBlockType:t.selectedLoraBlockType,selectedModelType:t.selectedModelType},e in U?(U[e]=U[e].filter(o=>o.loraParams!==t.loraParams),U[e].push(t)):U[e]=[t]}function _t(e){if(e in U){let t=R[e];U[e]=U[e].filter(o=>t&&t.has(o.loraParams))}}function ft(e,t){e in R?R[e].add(t):R[e]=new Set([t])}function gt(e,t){e in R&&R[e].delete(t)}function $(e,t){return e in R?R[e].has(t):!1}function mt(){localStorage.setItem("wh://histories",JSON.stringify(U));let e={};for(let t in R)e[t]=Array.from(R[t]);localStorage.setItem("wh://locks",JSON.stringify(e))}function ht(){let e=localStorage.getItem("wh://histories");e&&(U=JSON.parse(e));let t=localStorage.getItem("wh://locks");if(t){let o=JSON.parse(t);for(let n in o)R[n]=new Set(o[n])}}var yt={},Tt={};function St(e){return yt[e]}function wt(e,t){yt[e]={metadataState:t.metadataState,selectedLoraBlockType:t.weightState.selectedLoraBlockType,selectedModelType:t.weightState.selectedModelType,usingBlocks:t.usingBlocks}}function vt(e){return Tt[e]}function bt(e,t){Tt[e]=t}var kt,Mt,xt,Et,Lt,Ct={},Bt=0;function ue(){return kt}function Nt(e){kt=e}function de(){return Mt}function Pt(e){Mt=e}function ze(){return xt}function It(e){xt=e}function je(){return Et}function Me(e){Et=e}function Wt(){return Lt}function Ot(e){Lt=e}function xe(){return Bt||0}function At(e){Bt=+gradioApp().querySelector(`div:is([id^='tab_${e}'][class*='tabitem'])`).querySelector('div:is([id$="_steps"]) input[type=number]').value}function I(e,t){return Ct[e||v.Unknown][t||w.Unknown]}function Dt(e){let r=(gradioApp().querySelector(`div:is([id^='tab_${e}'][class*='tabitem'])`).querySelector("#lbw_ratiospreset textarea").value??"").split(`
`).filter(i=>i.trim()!==""),a={};for(let i of Object.values(v)){a[i]={};for(let l of Object.values(w)){let c={},p={};a[i][l]=c;let f=j(i,l).filter(s=>s==1).length;for(let s of r){let _=s.split(":");_.length==2&&_[1].split(",").length==f&&(c[_[0]]=_[1],p[_[1]]=_[0])}}}Ct=a}function Ee(e){let t=e.match(/^([A-Z]+)(\d+)-\1(\d+)$/);if(!t)return[e];let[,o,n,r]=t,a=parseInt(n),i=parseInt(r),l=[],c=a;for(;l.push(`${o}${c.toString().padStart(2,"0")}`),c!=i;)c+=a<i?1:-1;return l}function Z(e,t,o,n){let r=new Set(oe(e,t)),a=Object.entries(n).filter(([l])=>r.has(l)).map(l=>l[1].value).join(","),i=Object.entries(o).find(([,l])=>l===a);return i?i[0]:""}function Le(e){let t,o=typeof window.TAC_CFG<"u"&&window.TAC_CFG,n,r=typeof window.pilotIsActive<"u"&&window.pilotIsActive;try{o&&(t=window.TAC_CFG.activeIn.global,window.TAC_CFG.activeIn.global=!1),r&&(n=window.pilotIsActive,window.pilotIsActive=!1),e()}finally{o&&(window.TAC_CFG.activeIn.global=t),r&&(window.pilotIsActive=n)}}var Ut=e=>e.toLowerCase(),q=e=>e?{}:{display:"none"},G=e=>e?{}:{visibility:"hidden"},A=(e,t=void 0)=>{if(e.uiState.isWaiting)return!0;switch(t){case m.TENC:case m.UNET:case m.DYN:case m.START:case m.STOP:case void 0:return!1}return e.usingBlocks!==void 0&&!e.usingBlocks.has(t)};var Ro=/<(lora|lyco):([^:]+):([^>]+)>/;function Rt(e){let t=e.target;if(!window.opts.weight_helper_enabled)return;let o=window.getSelection()?.toString();if(o)return;let n=t.value,r=t.selectionStart,a=n.lastIndexOf("<",r-1),i=n.indexOf(">",r);if(a<0||i<0||(o=n.substring(a,i+1),(o.match(/</g)||[]).length!=1||(o.match(/>/g)||[]).length!=1))return;r=a;let l=Ro.exec(o);if(l){e.preventDefault();let c=l[1].toLowerCase(),p=l[2],f=l[3],s=t.closest("[id^='tab_'][class*='tabitem']").id.split("_")[1],_=r+l.index,u=_+l.input.trim().length;return{tabId:s,textarea:t,selectionStart:_,selectionEnd:u,namespace:c,loraName:p,loraParams:f,top:e.pageY+15,left:e.pageX}}}function K(e){let t=de(),o=ze(),n=je();t.value=t.value.substring(0,o)+e+t.value.substring(n),Me(o+e.length)}function Ho(e){Le(()=>{let t=de(),o=ze(),n=je();t.focus(),t.setSelectionRange(o,n),document.execCommand("insertText",!1,e)})}function W(e,t){let o=String(t.weights[m.TENC].value),n=0,r=0;for(let u of[m.UNET,m.DYN]){let y=t.weights[u],S=k(u).default,h=+y.value;(y.checkState||y.checkState===void 0&&h!=S)&&(r===n?o+=`:${h}`:o+=`:${Ut(u)}=${h}`,n++),r++}let a=k(m.START).default,i=t.weights[m.START].value,l=k(m.STOP).default,c=t.weights[m.STOP].value;c<0&&(c=k(m.STOP).default),i!=a&&c!=l?o+=`:step=${i}-${c}`:i!=a?o+=`:start=${i}`:c!=l&&(o+=`:stop=${c}`);let{selectedModelType:p,selectedLoraBlockType:f}=t,s=t.xyzMode,_=o;if(s)o+=":lbw=XYZ",_+=":lbw=XYZ";else if(p!==v.Unknown){let u=j(p,f).map((S,h)=>{if(S===1)return t.weights[ke(p)[h]]}).filter(S=>S!==void 0),y=k(m.LBW).default;if(!u.every(S=>S.value===y)){let S=u.map(g=>g.value).join(",");o+=`:lbw=${S}`;let h=I(p,f),T=Object.entries(h).find(([,g])=>S===g);T?_+=`:lbw=${T[0]}`:_+=`:lbw=${S}`}}return t.lbwe&&(o+=`:lbwe=${t.lbwe}`,_+=`:lbwe=${t.lbwe}`),{loraParams:o,loraDefine:`<lora:${e}:${_}>`}}function fe(e,t=!1){let o=W(e.loraName,e.weightState);window.opts.weight_helper_using_execCommand?e.srcLoraParams!==o.loraParams&&Ho(o.loraDefine):t&&K(Wt()),wt(e.loraName,e),e.weightState.xyzMode||ne(e.loraName,{loraParams:o.loraParams,...e.weightState}),mt()}function Ce(){return{loraName:"",metadataState:void 0,srcLoraParams:"",weightState:{selectedLoraBlockType:w.lora,selectedModelType:v.SD,weights:{},lbwe:"",xyzMode:!1},blockGroups:[],usingBlocks:void 0,preset:"",lbwPresets:{},uiState:{isVisible:!1,scale:1,pos:{top:0,right:0,bottom:0,left:0},isMoreButtonVisible:!0,isWaiting:!1},lock:!1,historyIndex:0,previewState:{modelId:"",triggerWords:[],negativeTriggerWords:[],modelName:"",thumbUrl:"",hasMetadata:!1,description:"",isDescriptionVisible:!1,isTagInsertButtonVisible:!1}}}function Ht(e,t,o,n,r){let a=v.Unknown,i=w.Unknown,l=X(t);if(l&&l.length>0){let S=l[l.length-1];a=S.selectedModelType??v.Unknown,i=S.selectedLoraBlockType??w.Unknown}let c,p,f=St(t);f&&(c=f.metadataState,a=f.selectedModelType??v.Unknown,i=f.selectedLoraBlockType??w.Unknown,p=f.usingBlocks);let s=Fo(e,o,a,i),_=I(s.selectedModelType,s.selectedLoraBlockType),u=W(t,s).loraParams,y=!1;for(let S of[m.UNET,m.DYN,m.START,m.STOP]){let h=s.weights[S],T=k(S).default,g=+h.value;if(!(h.checkState||h.checkState===void 0&&g!=T)){y=!0;break}}return{loraName:t,metadataState:c,srcLoraParams:u,weightState:s,blockGroups:V(s.selectedModelType,s.selectedLoraBlockType),usingBlocks:p,uiState:{isVisible:!0,scale:window.opts.weight_helper_context_menu_scale,isMoreButtonVisible:y,isWaiting:!c,pos:{top:n,right:0,bottom:0,left:r}},previewState:Vo(t),preset:Z(s.selectedModelType,s.selectedLoraBlockType,_,s.weights),lbwPresets:_,lock:$(t,u),historyIndex:l.length-1}}function Fo(e,t,o,n){let r=Be(t,o,n),{weights:a,lbwe:i,xyzMode:l}=r;return n===w.Unknown&&(n=e==="lora"?w.lora:w.lycoris),{selectedLoraBlockType:n,selectedModelType:o,weights:a,lbwe:i,xyzMode:l}}function Be(e,t,o){let n=e.split(":"),r={};for(let T=0;T<n.length;T++){let g,x;if(n[T].indexOf("=")>=0){let M=n[T].split("=");g=M[0].toLowerCase(),x=M[1]}else g=[O.te,O.unet,O.dyn][T],x=n[T];r[g]=x}let a=[];for(let T of Object.values(ee))for(let g of Object.values(te))a.push({modelType:T,loraBlockType:g,presets:I(T,g),masks:j(T,g)});let i=k(m.TENC).default,l,c,p=k(m.START).default,f=k(m.STOP).default,s=[],_="",u=!1;Object.entries(r).forEach(([T,g])=>{switch(T){case O.lbw:if(g==="XYZ"){u=!0;break}let x=g.split(",");for(let L of a){if(x.length===1)if(g in L.presets)x=L.presets[g].split(",");else continue;if(x.length===L.masks.filter(B=>B==1).length){t=L.modelType,o=L.loraBlockType;let B=0;for(let Se of L.masks)Se?(s.push(+x[B]),B++):s.push(0);break}}break;case O.step:let M=g.split("-");p=Math.round(+M[0]),f=Math.round(+M[1]);break;case O.lbwe:_=g;break;case O.te:i=+g;break;case O.unet:l=+g;break;case O.dyn:c=+g;break;case O.start:p=Math.round(+g);break;case O.stop:f=Math.round(+g);break}});let y=!0;l===void 0&&(l=k(m.UNET).default,y=!1);let S=!0;c===void 0&&(c=k(m.DYN).default,S=!1);let h={};if(t!==v.Unknown){let T=ke(t);if(s.length===0)for(let g=0;g<T.length;g++)s.push(k(m.LBW).default);s.forEach((g,x)=>{h[T[x]]={initValue:g,value:g,sliderMin:Math.min(g,k(m.LBW).min),sliderMax:Math.max(g,k(m.LBW).max)}})}return{selectedLoraBlockType:o,selectedModelType:t,weights:{[m.TENC]:{initValue:i,value:i,sliderMin:Math.min(i,k(m.TENC).min),sliderMax:Math.max(i,k(m.TENC).max)},[m.UNET]:{initValue:l,value:l,sliderMin:Math.min(l,k(m.UNET).min),sliderMax:Math.max(l,k(m.UNET).max),initCheckState:y,checkState:y},[m.DYN]:{initValue:c,value:c,sliderMin:Math.min(c,k(m.DYN).min),sliderMax:Math.max(c,k(m.DYN).max),initCheckState:S,checkState:S},[m.START]:{initValue:p,value:p,sliderMin:Math.min(p,k(m.START).min),sliderMax:Math.max(p,k(m.START).max)},[m.STOP]:{initValue:f,value:f,sliderMin:Math.min(f,k(m.STOP).min),sliderMax:Math.max(f,k(m.STOP).max)},...h},lbwe:_,xyzMode:u}}function Vo(e){let t=vt(e);return t||{modelId:"",triggerWords:[""],negativeTriggerWords:[""],modelName:"",thumbUrl:ve,hasMetadata:!1,description:"",isDescriptionVisible:!1,isTagInsertButtonVisible:!1}}var We,b,Gt,$o,J,Ft,Yt,Xt,zt,Je,Ze,qe,jt,ge={},Zt=[],Go=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,me=Array.isArray;function Y(e,t){for(var o in t)e[o]=t[o];return e}function Qe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function d(e,t,o){var n,r,a,i={};for(a in t)a=="key"?n=t[a]:a=="ref"?r=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?We.call(arguments,2):o),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]==null&&(i[a]=e.defaultProps[a]);return Pe(e,i,n,r,null)}function Pe(e,t,o,n,r){var a={type:e,props:t,key:o,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++Gt,__i:-1,__u:0};return r==null&&b.vnode!=null&&b.vnode(a),a}function N(e){return e.children}function H(e,t){this.props=e,this.context=t}function ae(e,t){if(t==null)return e.__?ae(e.__,e.__i+1):null;for(var o;t<e.__k.length;t++)if((o=e.__k[t])!=null&&o.__e!=null)return o.__e;return typeof e.type=="function"?ae(e):null}function qt(e){var t,o;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((o=e.__k[t])!=null&&o.__e!=null){e.__e=e.__c.base=o.__e;break}return qt(e)}}function Ke(e){(!e.__d&&(e.__d=!0)&&J.push(e)&&!Ie.__r++||Ft!=b.debounceRendering)&&((Ft=b.debounceRendering)||Yt)(Ie)}function Ie(){for(var e,t,o,n,r,a,i,l=1;J.length;)J.length>l&&J.sort(Xt),e=J.shift(),l=J.length,e.__d&&(o=void 0,r=(n=(t=e).__v).__e,a=[],i=[],t.__P&&((o=Y({},n)).__v=n.__v+1,b.vnode&&b.vnode(o),et(t.__P,o,n,t.__n,t.__P.namespaceURI,32&n.__u?[r]:null,a,r??ae(n),!!(32&n.__u),i),o.__v=n.__v,o.__.__k[o.__i]=o,Qt(a,o,i),o.__e!=r&&qt(o)));Ie.__r=0}function Kt(e,t,o,n,r,a,i,l,c,p,f){var s,_,u,y,S,h,T=n&&n.__k||Zt,g=t.length;for(c=Yo(o,t,T,c,g),s=0;s<g;s++)(u=o.__k[s])!=null&&(_=u.__i==-1?ge:T[u.__i]||ge,u.__i=s,h=et(e,u,_,r,a,i,l,c,p,f),y=u.__e,u.ref&&_.ref!=u.ref&&(_.ref&&tt(_.ref,null,u),f.push(u.ref,u.__c||y,u)),S==null&&y!=null&&(S=y),4&u.__u||_.__k===u.__k?c=Jt(u,c,e):typeof u.type=="function"&&h!==void 0?c=h:y&&(c=y.nextSibling),u.__u&=-7);return o.__e=S,c}function Yo(e,t,o,n,r){var a,i,l,c,p,f=o.length,s=f,_=0;for(e.__k=new Array(r),a=0;a<r;a++)(i=t[a])!=null&&typeof i!="boolean"&&typeof i!="function"?(c=a+_,(i=e.__k[a]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?Pe(null,i,null,null,null):me(i)?Pe(N,{children:i},null,null,null):i.constructor==null&&i.__b>0?Pe(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=e,i.__b=e.__b+1,l=null,(p=i.__i=Xo(i,o,c,s))!=-1&&(s--,(l=o[p])&&(l.__u|=2)),l==null||l.__v==null?(p==-1&&(r>f?_--:r<f&&_++),typeof i.type!="function"&&(i.__u|=4)):p!=c&&(p==c-1?_--:p==c+1?_++:(p>c?_--:_++,i.__u|=4))):e.__k[a]=null;if(s)for(a=0;a<f;a++)(l=o[a])!=null&&!(2&l.__u)&&(l.__e==n&&(n=ae(l)),to(l,l));return n}function Jt(e,t,o){var n,r;if(typeof e.type=="function"){for(n=e.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=e,t=Jt(n[r],t,o));return t}e.__e!=t&&(t&&e.type&&!o.contains(t)&&(t=ae(e)),o.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function he(e,t){return t=t||[],e==null||typeof e=="boolean"||(me(e)?e.some(function(o){he(o,t)}):t.push(e)),t}function Xo(e,t,o,n){var r,a,i=e.key,l=e.type,c=t[o];if(c===null&&e.key==null||c&&i==c.key&&l==c.type&&!(2&c.__u))return o;if(n>(c!=null&&!(2&c.__u)?1:0))for(r=o-1,a=o+1;r>=0||a<t.length;){if(r>=0){if((c=t[r])&&!(2&c.__u)&&i==c.key&&l==c.type)return r;r--}if(a<t.length){if((c=t[a])&&!(2&c.__u)&&i==c.key&&l==c.type)return a;a++}}return-1}function Vt(e,t,o){t[0]=="-"?e.setProperty(t,o??""):e[t]=o==null?"":typeof o!="number"||Go.test(t)?o:o+"px"}function Ne(e,t,o,n,r){var a;e:if(t=="style")if(typeof o=="string")e.style.cssText=o;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)o&&t in o||Vt(e.style,t,"");if(o)for(t in o)n&&o[t]==n[t]||Vt(e.style,t,o[t])}else if(t[0]=="o"&&t[1]=="n")a=t!=(t=t.replace(zt,"$1")),t=t.toLowerCase()in e||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=o,o?n?o.u=n.u:(o.u=Je,e.addEventListener(t,a?qe:Ze,a)):e.removeEventListener(t,a?qe:Ze,a);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=o??"";break e}catch{}typeof o=="function"||(o==null||o===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&o==1?"":o))}}function $t(e){return function(t){if(this.l){var o=this.l[t.type+e];if(t.t==null)t.t=Je++;else if(t.t<o.u)return;return o(b.event?b.event(t):t)}}}function et(e,t,o,n,r,a,i,l,c,p){var f,s,_,u,y,S,h,T,g,x,M,L,B,Se,we,le,Ge,F=t.type;if(t.constructor!=null)return null;128&o.__u&&(c=!!(32&o.__u),a=[l=t.__e=o.__e]),(f=b.__b)&&f(t);e:if(typeof F=="function")try{if(T=t.props,g="prototype"in F&&F.prototype.render,x=(f=F.contextType)&&n[f.__c],M=f?x?x.props.value:f.__:n,o.__c?h=(s=t.__c=o.__c).__=s.__E:(g?t.__c=s=new F(T,M):(t.__c=s=new H(T,M),s.constructor=F,s.render=jo),x&&x.sub(s),s.props=T,s.state||(s.state={}),s.context=M,s.__n=n,_=s.__d=!0,s.__h=[],s._sb=[]),g&&s.__s==null&&(s.__s=s.state),g&&F.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=Y({},s.__s)),Y(s.__s,F.getDerivedStateFromProps(T,s.__s))),u=s.props,y=s.state,s.__v=t,_)g&&F.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),g&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(g&&F.getDerivedStateFromProps==null&&T!==u&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(T,M),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(T,s.__s,M)===!1||t.__v==o.__v){for(t.__v!=o.__v&&(s.props=T,s.state=s.__s,s.__d=!1),t.__e=o.__e,t.__k=o.__k,t.__k.some(function(ce){ce&&(ce.__=t)}),L=0;L<s._sb.length;L++)s.__h.push(s._sb[L]);s._sb=[],s.__h.length&&i.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(T,s.__s,M),g&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(u,y,S)})}if(s.context=M,s.props=T,s.__P=e,s.__e=!1,B=b.__r,Se=0,g){for(s.state=s.__s,s.__d=!1,B&&B(t),f=s.render(s.props,s.state,s.context),we=0;we<s._sb.length;we++)s.__h.push(s._sb[we]);s._sb=[]}else do s.__d=!1,B&&B(t),f=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++Se<25);s.state=s.__s,s.getChildContext!=null&&(n=Y(Y({},n),s.getChildContext())),g&&!_&&s.getSnapshotBeforeUpdate!=null&&(S=s.getSnapshotBeforeUpdate(u,y)),le=f,f!=null&&f.type===N&&f.key==null&&(le=eo(f.props.children)),l=Kt(e,me(le)?le:[le],t,o,n,r,a,i,l,c,p),s.base=t.__e,t.__u&=-161,s.__h.length&&i.push(s),h&&(s.__E=s.__=null)}catch(ce){if(t.__v=null,c||a!=null)if(ce.then){for(t.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,t.__e=l}else for(Ge=a.length;Ge--;)Qe(a[Ge]);else t.__e=o.__e,t.__k=o.__k;b.__e(ce,t,o)}else a==null&&t.__v==o.__v?(t.__k=o.__k,t.__e=o.__e):l=t.__e=zo(o.__e,t,o,n,r,a,i,c,p);return(f=b.diffed)&&f(t),128&t.__u?void 0:l}function Qt(e,t,o){for(var n=0;n<o.length;n++)tt(o[n],o[++n],o[++n]);b.__c&&b.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(a){a.call(r)})}catch(a){b.__e(a,r.__v)}})}function eo(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:me(e)?e.map(eo):Y({},e)}function zo(e,t,o,n,r,a,i,l,c){var p,f,s,_,u,y,S,h=o.props,T=t.props,g=t.type;if(g=="svg"?r="http://www.w3.org/2000/svg":g=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),a!=null){for(p=0;p<a.length;p++)if((u=a[p])&&"setAttribute"in u==!!g&&(g?u.localName==g:u.nodeType==3)){e=u,a[p]=null;break}}if(e==null){if(g==null)return document.createTextNode(T);e=document.createElementNS(r,g,T.is&&T),l&&(b.__m&&b.__m(t,a),l=!1),a=null}if(g==null)h===T||l&&e.data==T||(e.data=T);else{if(a=a&&We.call(e.childNodes),h=o.props||ge,!l&&a!=null)for(h={},p=0;p<e.attributes.length;p++)h[(u=e.attributes[p]).name]=u.value;for(p in h)if(u=h[p],p!="children"){if(p=="dangerouslySetInnerHTML")s=u;else if(!(p in T)){if(p=="value"&&"defaultValue"in T||p=="checked"&&"defaultChecked"in T)continue;Ne(e,p,null,u,r)}}for(p in T)u=T[p],p=="children"?_=u:p=="dangerouslySetInnerHTML"?f=u:p=="value"?y=u:p=="checked"?S=u:l&&typeof u!="function"||h[p]===u||Ne(e,p,u,h[p],r);if(f)l||s&&(f.__html==s.__html||f.__html==e.innerHTML)||(e.innerHTML=f.__html),t.__k=[];else if(s&&(e.innerHTML=""),Kt(t.type=="template"?e.content:e,me(_)?_:[_],t,o,n,g=="foreignObject"?"http://www.w3.org/1999/xhtml":r,a,i,a?a[0]:o.__k&&ae(o,0),l,c),a!=null)for(p=a.length;p--;)Qe(a[p]);l||(p="value",g=="progress"&&y==null?e.removeAttribute("value"):y!=null&&(y!==e[p]||g=="progress"&&!y||g=="option"&&y!=h[p])&&Ne(e,p,y,h[p],r),p="checked",S!=null&&S!=e[p]&&Ne(e,p,S,h[p],r))}return e}function tt(e,t,o){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(r){b.__e(r,o)}}function to(e,t,o){var n,r;if(b.unmount&&b.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||tt(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(a){b.__e(a,t)}n.base=n.__P=null}if(n=e.__k)for(r=0;r<n.length;r++)n[r]&&to(n[r],t,o||typeof e.type!="function");o||Qe(e.__e),e.__c=e.__=e.__e=void 0}function jo(e,t,o){return this.constructor(e,o)}function ot(e,t,o){var n,r,a,i;t==document&&(t=document.documentElement),b.__&&b.__(e,t),r=(n=typeof o=="function")?null:o&&o.__k||t.__k,a=[],i=[],et(t,e=(!n&&o||t).__k=d(N,null,[e]),r||ge,ge,t.namespaceURI,!n&&o?[o]:r?null:t.firstChild?We.call(t.childNodes):null,a,!n&&o?o:r?r.__e:t.firstChild,n,i),Qt(a,e,i)}function Oe(e){function t(o){var n,r;return this.getChildContext||(n=new Set,(r={})[t.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(a){this.props.value!=a.value&&n.forEach(function(i){i.__e=!0,Ke(i)})},this.sub=function(a){n.add(a);var i=a.componentWillUnmount;a.componentWillUnmount=function(){n&&n.delete(a),i&&i.call(a)}}),o.children}return t.__c="__cC"+jt++,t.__=e,t.Provider=t.__l=(t.Consumer=function(o,n){return o.children(n)}).contextType=t,t}We=Zt.slice,b={__e:function(e,t,o,n){for(var r,a,i;t=t.__;)if((r=t.__c)&&!r.__)try{if((a=r.constructor)&&a.getDerivedStateFromError!=null&&(r.setState(a.getDerivedStateFromError(e)),i=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,n||{}),i=r.__d),i)return r.__E=r}catch(l){e=l}throw e}},Gt=0,$o=function(e){return e!=null&&e.constructor==null},H.prototype.setState=function(e,t){var o;o=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Y({},this.state),typeof e=="function"&&(e=e(Y({},o),this.props)),e&&Y(o,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ke(this))},H.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ke(this))},H.prototype.render=N,J=[],Yt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Xt=function(e,t){return e.__v.__b-t.__v.__b},Ie.__r=0,zt=/(PointerCapture)$|Capture$/i,Je=0,Ze=$t(!1),qe=$t(!0),jt=0;var ie,E,nt,oo,rt=0,po=[],C=b,no=C.__b,ro=C.__r,ao=C.diffed,io=C.__c,so=C.unmount,lo=C.__;function De(e,t){C.__h&&C.__h(E,e,rt||t),rt=0;var o=E.__H||(E.__H={__:[],__h:[]});return e>=o.__.length&&o.__.push({}),o.__[e]}function it(e,t,o){var n=De(ie++,2);if(n.t=e,!n.__c&&(n.__=[o?o(t):Ko(void 0,t),function(l){var c=n.__N?n.__N[0]:n.__[0],p=n.t(c,l);c!==p&&(n.__N=[p,n.__[1]],n.__c.setState({}))}],n.__c=E,!E.__f)){var r=function(l,c,p){if(!n.__c.__H)return!0;var f=n.__c.__H.__.filter(function(_){return!!_.__c});if(f.every(function(_){return!_.__N}))return!a||a.call(this,l,c,p);var s=n.__c.props!==l;return f.forEach(function(_){if(_.__N){var u=_.__[0];_.__=_.__N,_.__N=void 0,u!==_.__[0]&&(s=!0)}}),a&&a.call(this,l,c,p)||s};E.__f=!0;var a=E.shouldComponentUpdate,i=E.componentWillUpdate;E.componentWillUpdate=function(l,c,p){if(this.__e){var f=a;a=void 0,r(l,c,p),a=f}i&&i.call(this,l,c,p)},E.shouldComponentUpdate=r}return n.__N||n.__}function st(e,t){var o=De(ie++,3);!C.__s&&_o(o.__H,t)&&(o.__=e,o.u=t,E.__H.__h.push(o))}function se(e){return rt=5,uo(function(){return{current:e}},[])}function uo(e,t){var o=De(ie++,7);return _o(o.__H,t)&&(o.__=e(),o.__H=t,o.__h=e),o.__}function lt(e){var t=E.context[e.__c],o=De(ie++,9);return o.c=e,t?(o.__==null&&(o.__=!0,t.sub(E)),t.props.value):e.__}function Zo(){for(var e;e=po.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Ae),e.__H.__h.forEach(at),e.__H.__h=[]}catch(t){e.__H.__h=[],C.__e(t,e.__v)}}C.__b=function(e){E=null,no&&no(e)},C.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),lo&&lo(e,t)},C.__r=function(e){ro&&ro(e),ie=0;var t=(E=e.__c).__H;t&&(nt===E?(t.__h=[],E.__h=[],t.__.forEach(function(o){o.__N&&(o.__=o.__N),o.u=o.__N=void 0})):(t.__h.forEach(Ae),t.__h.forEach(at),t.__h=[],ie=0)),nt=E},C.diffed=function(e){ao&&ao(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(po.push(t)!==1&&oo===C.requestAnimationFrame||((oo=C.requestAnimationFrame)||qo)(Zo)),t.__H.__.forEach(function(o){o.u&&(o.__H=o.u),o.u=void 0})),nt=E=null},C.__c=function(e,t){t.some(function(o){try{o.__h.forEach(Ae),o.__h=o.__h.filter(function(n){return!n.__||at(n)})}catch(n){t.some(function(r){r.__h&&(r.__h=[])}),t=[],C.__e(n,o.__v)}}),io&&io(e,t)},C.unmount=function(e){so&&so(e);var t,o=e.__c;o&&o.__H&&(o.__H.__.forEach(function(n){try{Ae(n)}catch(r){t=r}}),o.__H=void 0,t&&C.__e(t,o.__v))};var co=typeof requestAnimationFrame=="function";function qo(e){var t,o=function(){clearTimeout(n),co&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(o,100);co&&(t=requestAnimationFrame(o))}function Ae(e){var t=E,o=e.__c;typeof o=="function"&&(e.__c=void 0,o()),E=t}function at(e){var t=E;e.__c=e.__(),E=t}function _o(e,t){return!e||e.length!==t.length||t.some(function(o,n){return o!==e[n]})}function Ko(e,t){return typeof t=="function"?t(e):t}function Qo(e,t){for(var o in t)e[o]=t[o];return e}function fo(e,t){for(var o in e)if(o!=="__source"&&!(o in t))return!0;for(var n in t)if(n!=="__source"&&e[n]!==t[n])return!0;return!1}function go(e,t){this.props=e,this.context=t}(go.prototype=new H).isPureReactComponent=!0,go.prototype.shouldComponentUpdate=function(e,t){return fo(this.props,e)||fo(this.state,t)};var mo=b.__b;b.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),mo&&mo(e)};var zn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var en=b.__e;b.__e=function(e,t,o,n){if(e.then){for(var r,a=t;a=a.__;)if((r=a.__c)&&r.__c)return t.__e==null&&(t.__e=o.__e,t.__k=o.__k),r.__c(e,t)}en(e,t,o,n)};var ho=b.unmount;function bo(e,t,o){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),e.__c.__H=null),(e=Qo({},e)).__c!=null&&(e.__c.__P===o&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(n){return bo(n,t,o)})),e}function ko(e,t,o){return e&&o&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(n){return ko(n,t,o)}),e.__c&&e.__c.__P===t&&(e.__e&&o.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=o)),e}function ct(){this.__u=0,this.o=null,this.__b=null}function Mo(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function Ue(){this.i=null,this.l=null}b.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),ho&&ho(e)},(ct.prototype=new H).__c=function(e,t){var o=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(o);var r=Mo(n.__v),a=!1,i=function(){a||(a=!0,o.__R=null,r?r(l):l())};o.__R=i;var l=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=ko(c,c.__c.__P,c.__c.__O)}var p;for(n.setState({__a:n.__b=null});p=n.o.pop();)p.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),e.then(i,i)},ct.prototype.componentWillUnmount=function(){this.o=[]},ct.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var o=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=bo(this.__b,o,n.__O=n.__P)}this.__b=null}var r=t.__a&&d(N,null,e.fallback);return r&&(r.__u&=-33),[d(N,null,t.__a?null:e.children),r]};var yo=function(e,t,o){if(++o[1]===o[0]&&e.l.delete(t),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(o=e.i;o;){for(;o.length>3;)o.pop()();if(o[1]<o[0])break;e.i=o=o[2]}};(Ue.prototype=new H).__a=function(e){var t=this,o=Mo(t.__v),n=t.l.get(e);return n[0]++,function(r){var a=function(){t.props.revealOrder?(n.push(r),yo(t,e,n)):r()};o?o(a):a()}},Ue.prototype.render=function(e){this.i=null,this.l=new Map;var t=he(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&t.reverse();for(var o=t.length;o--;)this.l.set(t[o],this.i=[1,0,this.i]);return e.children},Ue.prototype.componentDidUpdate=Ue.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(t,o){yo(e,o,t)})};var tn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,on=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,nn=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,rn=/[A-Z0-9]/g,an=typeof document<"u",sn=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};H.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(H.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var To=b.event;function ln(){}function cn(){return this.cancelBubble}function pn(){return this.defaultPrevented}b.event=function(e){return To&&(e=To(e)),e.persist=ln,e.isPropagationStopped=cn,e.isDefaultPrevented=pn,e.nativeEvent=e};var xo,un={enumerable:!1,configurable:!0,get:function(){return this.class}},So=b.vnode;b.vnode=function(e){typeof e.type=="string"&&function(t){var o=t.props,n=t.type,r={},a=n.indexOf("-")===-1;for(var i in o){var l=o[i];if(!(i==="value"&&"defaultValue"in o&&l==null||an&&i==="children"&&n==="noscript"||i==="class"||i==="className")){var c=i.toLowerCase();i==="defaultValue"&&"value"in o&&o.value==null?i="value":i==="download"&&l===!0?l="":c==="translate"&&l==="no"?l=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?i="ondblclick":c!=="onchange"||n!=="input"&&n!=="textarea"||sn(o.type)?c==="onfocus"?i="onfocusin":c==="onblur"?i="onfocusout":nn.test(i)&&(i=c):c=i="oninput":a&&on.test(i)?i=i.replace(rn,"-$&").toLowerCase():l===null&&(l=void 0),c==="oninput"&&r[i=c]&&(i="oninputCapture"),r[i]=l}}n=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=he(o.children).forEach(function(p){p.props.selected=r.value.indexOf(p.props.value)!=-1})),n=="select"&&r.defaultValue!=null&&(r.value=he(o.children).forEach(function(p){p.props.selected=r.multiple?r.defaultValue.indexOf(p.props.value)!=-1:r.defaultValue==p.props.value})),o.class&&!o.className?(r.class=o.class,Object.defineProperty(r,"className",un)):(o.className&&!o.class||o.class&&o.className)&&(r.class=r.className=o.className),t.props=r}(e),e.$$typeof=tn,So&&So(e)};var wo=b.__r;b.__r=function(e){wo&&wo(e),xo=e.__c};var vo=b.diffed;b.diffed=function(e){vo&&vo(e);var t=e.props,o=e.__e;o!=null&&e.type==="textarea"&&"value"in t&&t.value!==o.value&&(o.value=t.value==null?"":t.value),xo=null};var Re=null,He=null;function Fe(){return Re&&Re.abort(),Re=new AbortController,Re}function Eo(){return He&&He.abort(),He=new AbortController,He}async function Ve(e,t,o){let n=await fetch(`/whapi/v1/get_metadata?key=${encodeURIComponent(e)}&force=${t}`,{method:"POST",signal:o});if(!n.ok)throw new Error(`Failed to set up API endpoints. Please reload the page.: ${n.status}`);return await n.json()}async function Lo(e,t){let o=await fetch(`/whapi/v1/get_preview_info?key=${encodeURIComponent(e)}`,{method:"POST",signal:t});if(!o.ok)throw new Error(`Failed to set up API endpoints. Please reload the page.: ${o.status}`);return{...await o.json(),isDescriptionVisible:!1,isTagInsertButtonVisible:!0}}function Q(e,t){let o={...e},n=[];return t.forEach(r=>{Ee(r).forEach(i=>{n.includes(i)||n.push(i)})}),n.forEach(r=>{o[r]||(o[r]={initValue:k(m.LBW).default,value:k(m.LBW).default,sliderMin:k(m.LBW).min,sliderMax:k(m.LBW).max})}),o}var ye=({label:e,values:t})=>{let{state:o,dispatch:n}=P(),r=k(e)??k(m.LBW),a=p=>{let f=p.target;n({type:"SET_WEIGHT",payload:{block:e,value:o.weightState.weights[e].value,checkState:f.checked}})},i=p=>{let s=+p.target.value/100,_=o.weightState.weights[e].checkState;_!==void 0&&(_=!0),n({type:"SET_WEIGHT",payload:{block:e,value:s,checkState:_}})},l=p=>{let s=+p.target.value,_=o.weightState.weights[e].checkState;_!==void 0&&(_=!0),n({type:"SET_WEIGHT",payload:{block:e,value:s,checkState:_}})},c=t[e];return d(N,{key:e},d("span",null,d("label",null,e),o.weightState.weights[e].checkState!==void 0&&d("input",{type:"checkbox",checked:o.weightState.weights[e].checkState,onChange:a})),d("div",{className:"f f-c g-4"},d("input",{className:"slider",type:"range",value:Math.round(c.value*100),min:Math.round(c.sliderMin*100),max:Math.round(c.sliderMax*100),step:Math.round(r.step*100),disabled:A(o,e),onChange:i}),d("input",{className:"value",type:"number",value:+c.value,step:r.step,disabled:A(o,e),onChange:l})))};var Co=({loraName:e,lock:t})=>{let{state:o,dispatch:n}=P(),r=X(o.loraName),a=se(!1),i=se({x:0,y:0}),l=y=>{a.current=!0,i.current={x:y.clientX-o.uiState.pos.left+window.scrollX,y:y.clientY-o.uiState.pos.top+window.scrollY},document.addEventListener("mousemove",c),document.addEventListener("mouseup",p)},c=y=>{if(!a.current)return;let S=y.clientX-i.current.x+window.scrollX,h=y.clientY-i.current.y+window.scrollY;n({type:"SET_POSITION",payload:{top:h,left:S}})},p=()=>{a.current=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",p)},f=()=>{n({type:"CLEAR_HISTORY"})},s=()=>{n({type:"TOGGLE_LOCK_STATUS"})},_=()=>{let y=Math.max(0,o.historyIndex-1),S=r[y],h=Be(S.loraParams,S.selectedModelType,S.selectedLoraBlockType),T=$(o.loraName,S.loraParams),g=Z(S.selectedModelType,S.selectedLoraBlockType,o.lbwPresets,h.weights);n({type:"SET_HISTORY",payload:{historyIndex:y,weightState:h,locked:T,preset:g}})},u=()=>{let y=Math.min(r.length-1,o.historyIndex+1),S=r[y],h=Be(S.loraParams,S.selectedModelType,S.selectedLoraBlockType),T=$(o.loraName,S.loraParams),g=Z(S.selectedModelType,S.selectedLoraBlockType,o.lbwPresets,h.weights);n({type:"SET_HISTORY",payload:{historyIndex:y,weightState:h,locked:T,preset:g}})};return d("header",{onMouseDown:l},d("span",null,d("span",{className:`lock ${t?"like":"unlike"}`,style:G(!o.weightState.xyzMode),onClick:s},d("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},d("path",{d:"M21,10H19V7A7,7,0,0,0,5,7v3H3a1,1,0,0,0-1,1v9a4,4,0,0,0,4,4H18a4,4,0,0,0,4-4V11A1,1,0,0,0,21,10Zm-9,9.5A2.5,2.5,0,1,1,14.5,17,2.5,2.5,0,0,1,12,19.5ZM15,10H9V7a3,3,0,0,1,6,0v3Z"}))),d("label",{className:"name"},e)),d("div",{className:"history",style:q(r.length>1)},d("a",{className:"icon",onClick:f},"clear"),d("div",{className:"page"},d("a",{className:"icon",onClick:_,style:G(o.historyIndex>0)},"<"),d("label",{className:"page-label"},o.historyIndex+1+"/"+r.length),d("a",{className:"icon",onClick:u,style:G(o.historyIndex<r.length-1)},">"))))};var Bo=()=>{let{state:e}=P(),{blockGroups:t,weightState:o}=e,{selectedModelType:n,selectedLoraBlockType:r}=o,a=new Set(oe(n,r));return d("div",{className:"f col g-2",key:`${n}-${r}-${e.usingBlocks}`,style:{display:"flex"}},t.map(i=>d("div",{className:"border p f g-2 col",key:`${i}-${n}-${r}-${e.usingBlocks}`},Ee(i).map(l=>a.has(l)&&o.weights[l]&&d("div",{class:"f g-2",key:`${l}-${n}-${r}-${A(e,l)}`},d(ye,{label:l,values:o.weights}))))))};var No=()=>{let{state:e,dispatch:t}=P(),o=i=>{let c=i.target.value,p=V(e.weightState.selectedModelType,c),f=I(e.weightState.selectedModelType,c),s=Q(e.weightState.weights,p);t({type:"SET_MODELINFO",payload:{selectedLoraBlockType:c,selectedModelType:e.weightState.selectedModelType,blockGroups:p,lbwPresets:f,weights:s}})},n=i=>{let c=i.target.value,p=V(c,e.weightState.selectedLoraBlockType),f=I(c,e.weightState.selectedLoraBlockType),s=Q(e.weightState.weights,p);t({type:"SET_MODELINFO",payload:{selectedModelType:c,selectedLoraBlockType:e.weightState.selectedLoraBlockType,blockGroups:p,lbwPresets:f,weights:s}})},r=()=>{t({type:"TOGGLE_XYZ_MODE"})},a=i=>{let l=i.target,c=l.value;if(c===""&&(c=e.preset,c===""))return;let p=I(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType)[c].split(",").map(_=>+_),f={};oe(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType).forEach((_,u)=>{f[_]={initValue:e.weightState.weights[_].initValue,value:p[u],sliderMin:Math.min(p[u],e.weightState.weights[_].sliderMin),sliderMax:Math.max(p[u],e.weightState.weights[_].sliderMax)}}),t({type:"SET_PRESET",payload:{weights:f,preset:l.value}})};return d(N,null,d("div",{className:"f g-2 f-end"},d("select",{value:e.weightState.selectedModelType,style:{flexGrow:1},disabled:A(e),onChange:n},Object.entries(ee).map(([i,l])=>d("option",{value:l},i))),d("select",{value:e.weightState.selectedLoraBlockType,style:{flexGrow:1},disabled:A(e),onChange:o},Object.entries(te).map(([i,l])=>d("option",{value:l},i)))),d("div",{className:"f g-2 f-end"},d("select",{value:e.preset,style:{flexGrow:1},disabled:A(e),onChange:a},d("option",{value:""}),Object.keys(e.lbwPresets).map(i=>d("option",{value:i},i))),d("div",{className:"p f g-2 f-end"},d("div",{className:"f g-2 f-end"},d("input",{id:"wh:xyz",value:"XYZ",type:"checkbox",checked:e.weightState.xyzMode,disabled:A(e),onChange:r}),d("label",{className:"radio-label",for:"wh:xyz"},"XYZ")))))};var Po=()=>{let{state:e,dispatch:t}=P(),o=()=>{if(e.uiState.isWaiting)return;let n=Fe();t({type:"SET_WAITING",payload:!0}),Ve(e.loraName,!0,n.signal).then(r=>{let a=e.weightState.selectedModelType;(!a||a===v.Unknown)&&(a=r.modelType??v.Unknown);let i=V(a,e.weightState.selectedLoraBlockType),l=Q(e.weightState.weights,i);t({type:"LOAD_METADATA",payload:{algorithm:r.algorithm||"Unknown",modelType:r.modelType||"Unknown",baseModel:r.baseModel||"Unknown",selectedModelType:a,usingBlocks:r.usingBlocks,blockGroups:i,lbwPresets:I(a,e.weightState.selectedLoraBlockType),weights:l}})}).catch(r=>{r.name!=="AbortError"&&(console.error("Error fetching metadata:",r),t({type:"SET_WAITING",payload:!1}))})};return d("span",{className:"metadata"},d("span",null,d("span",null,"Model"),d("span",null,e.metadataState?.modelType||"Unknown")),d("span",null,d("span",null,"Base"),d("span",null,e.metadataState?.baseModel||"Unknown")),d("a",{className:"icon mini svg",onClick:o},d("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 492 492"},d("g",null,d("path",{d:"M484.08,296.216c-5.1-5.128-11.848-7.936-19.032-7.936H330.516c-14.828,0-26.86,12.036-26.86,26.868v22.796c0,7.168,2.784,14.064,7.884,19.16c5.092,5.088,11.82,8.052,18.976,8.052H366.1c-31.544,30.752-74.928,50.08-120.388,50.08c-71.832,0-136.028-45.596-159.744-113.344c-5.392-15.404-19.972-25.784-36.28-25.784c-4.316,0-8.592,0.708-12.7,2.144c-9.692,3.396-17.48,10.352-21.932,19.596c-4.456,9.248-5.04,19.684-1.648,29.368c34.496,98.54,127.692,164.74,232.144,164.74c64.132,0,123.448-23.948,169.572-67.656v25.22c0,14.836,12.384,27.108,27.224,27.108h22.792c14.84,0,26.86-12.272,26.86-27.108V315.24C492,308.056,489.2,301.304,484.08,296.216z"})),d("g",null,d("path",{d:"M478.628,164.78C444.132,66.244,350.916,0.044,246.464,0.044c-64.136,0-123.464,23.952-169.588,67.66v-25.22c0-14.832-12.344-27.112-27.184-27.112H26.896C12.06,15.372,0,27.652,0,42.484V176.76c0,7.18,2.824,13.868,7.944,18.964c5.096,5.128,11.86,7.932,19.044,7.932l-0.08,0.06h134.604c14.84,0,26.832-12.028,26.832-26.86v-22.8c0-14.836-11.992-27.216-26.832-27.216h-35.576c31.544-30.752,74.932-50.076,120.392-50.076c71.832,0,136.024,45.596,159.74,113.348c5.392,15.404,19.968,25.78,36.28,25.78c4.32,0,8.588-0.704,12.7-2.144c9.696-3.396,17.48-10.348,21.932-19.596C481.432,184.9,482.02,174.472,478.628,164.78z"})))))};var Io=({preview:e,topComponent:t})=>{let{state:o,dispatch:n}=P(),r=u=>{extraNetworksRequestMetadata(u,"lora",e.modelName)},a=u=>{extraNetworksEditUserMetadata(u,ue(),"lora",o.previewState.modelName)},i=()=>{window.open(`https://civitai.com/models/${e.modelId}`,"_blank")},l=()=>{n({type:"SET_PREVIEW_DESCRIPTION_VISIBLE",payload:!0})},c=()=>{n({type:"SET_PREVIEW_DESCRIPTION_VISIBLE",payload:!1})},p=()=>{let u=ue(),y=document.querySelector(`#${u}_prompt textarea`),S=document.querySelector(`#${u}_neg_prompt textarea`),h=de();if(h===S||h!==y&&(y=h,S=void 0),!window.opts.weight_helper_using_execCommand)(()=>{let g=[{triggerWords:e.triggerWords,textarea:y},{triggerWords:e.negativeTriggerWords,textarea:S}];for(let{triggerWords:x,textarea:M}of g)if(x.length>0&&M){let L=x.join(", ");M.value&&(L=", "+L),M.value+=L}})();else{let T=()=>{let g=[{triggerWords:e.triggerWords,textarea:y},{triggerWords:e.negativeTriggerWords,textarea:S}];for(let{triggerWords:x,textarea:M}of g)if(x.length>0&&M){let L=x.join(", ");M.value&&(L=", "+L),M.focus();let B=M.value.length;M.setSelectionRange(B,B),document.execCommand("insertText",!1,L)}};Le(()=>{T()})}n({type:"HIDE_TAG_INSERT_BUTTON"})},f=+(t?.clientWidth||0),s=6,_={};switch(window.opts.weight_helper_preview_position){case"Bottom Right":_.bottom="0px",_.left=f+s+"px";break;case"Top Left":_.top="0px",_.right=f-s+"px";break;case"Bottom Left":_.right=f-s+"px",_.bottom="0px";break;default:_.top="0px",_.left=f+s+"px";break}return d("div",{className:"preview-pane card","data-name":e.modelName,style:{..._}},d("img",{className:"preview",src:e.thumbUrl,style:{height:`${window.opts.weight_helper_preview_height}px`}}),d("div",{className:"action-row button-top",style:G(!e.isDescriptionVisible)},e.modelName&&e.hasMetadata&&typeof extraNetworksRequestMetadata=="function"&&d("div",{className:"metadata-btn card-btn",title:"Show internal metadata",onClick:r}),e.modelName&&typeof extraNetworksEditUserMetadata=="function"&&d("div",{className:"edit-btn card-btn",title:"Edit metadata",onClick:a}),e.modelId&&d("div",{className:"civitai-btn card-btn",title:"Open civitai",onClick:i}),(e.triggerWords.length>0||e.negativeTriggerWords.length>0)&&d("div",{className:"add-trigger-btn card-btn",title:"Add trigger words",onClick:p,style:q(e.isTagInsertButtonVisible)})),e.description&&d(N,null,d("div",{className:"action-row button-bottom",style:G(!e.isDescriptionVisible)},d("div",{className:"card-btn note-btn",onClick:l})),d("textarea",{className:"description",style:G(e.isDescriptionVisible)},e.description),d("div",{className:"card-btn description-close-btn",style:G(e.isDescriptionVisible),onClick:c})))};var Wo=()=>{let{state:e,dispatch:t}=P(),{uiState:o,weightState:n,lock:r,previewState:a}=e;st(()=>{let l=()=>{e.uiState.isVisible&&(Te(t),fe(e))},c=gradioApp().querySelectorAll("button:is([id*='_generate'])");c.forEach(u=>{u.addEventListener("click",l,!0)});let p=u=>{if(e.uiState.isVisible){u.preventDefault(),Te(t),fe(e);return}let y=Rt(u);y&&(u.preventDefault(),dn(t,y))},f=gradioApp().querySelectorAll("*:is([id*='_toprow'] [id*='_prompt'], .prompt) textarea");f.forEach(u=>{u.addEventListener("contextmenu",p)});let s=u=>{if(e.uiState.isVisible){let y=document.getElementById("weight-helper");if(!y)return;let S=ue();if(u){let h=u.target;if(y.contains(h)||h.id===`${S}_token_button`||h.id===`${S}_lora_edit_user_metadata_button`||h.className==="global-popup-close")return;if(h.id.indexOf("_interrupt")>0){Te(t);return}}Te(t),fe(e)}};document.addEventListener("click",s);let _=u=>{u.key==="Escape"&&_n(e,t)};return document.addEventListener("keyup",_),()=>{c.forEach(u=>{u.removeEventListener("click",l,!0)}),f.forEach(u=>{u.removeEventListener("contextmenu",p)}),document.removeEventListener("click",s),document.removeEventListener("keyup",_)}},[e]);let i=se(null);return d("div",{id:"weight-helper",ref:i,className:e.uiState.isWaiting?"waiting":"",style:{transform:`scale(${o.scale})`,top:`${o.pos.top}px`,left:`${o.pos.left}px`,...q(o.isVisible)}},d(Co,{loraName:e.loraName,lock:r}),d(Po,null),n.weights[m.TENC]&&d("section",{className:"border p"},d(ye,{label:m.TENC,values:n.weights})),[m.UNET,m.DYN,m.START,m.STOP].map(l=>n.weights[l]&&d("section",{className:"border p",style:q(!o.isMoreButtonVisible||n.weights[l].initCheckState||n.weights[l].initValue!==k(l).default)},d(ye,{label:l,values:n.weights}))),d("button",{style:o.isMoreButtonVisible?{}:{display:"none"},disabled:A(e),onClick:()=>t({type:"HIDE_MORE_BUTTON"})},"show more options"),d("section",{className:"border p"},d("label",null,"LBW"),d("div",{className:"f col g-4 w-fill"},d(No,null),d(Bo,null))),d(Io,{preview:a,topComponent:i.current}))};function dn(e,t){let{tabId:o,textarea:n,selectionStart:r,selectionEnd:a,namespace:i,loraName:l,loraParams:c,top:p,left:f}=t;Nt(o),Pt(n),It(r),Me(a),Ot(n.value.substring(r,a)),At(o),Dt(o),k(m.START).max=xe(),k(m.STOP).max=xe(),k(m.STOP).default=xe();let s=document.getElementById("weight-helper").getBoundingClientRect(),_=window.innerHeight-s.bottom,u=p;_<0&&(s.top<0?u=window.scrollY:u+=_);let y=Ht(i,l,c,u,f);if(e({type:"OPEN_CONTEXT",payload:y}),!y.metadataState){let S=Fe();Ve(l,!1,S.signal).then(h=>{let T=y.weightState.selectedModelType;(!T||T===v.Unknown)&&(T=h.modelType??v.Unknown);let g=y.weightState.selectedLoraBlockType,x=V(T,g),M=Q(y.weightState.weights,x),L={...y.weightState,selectedModelType:T,selectedLoraBlockType:g},B=W(y.loraName,L).loraParams;y.weightState.xyzMode||(ne(l,{loraParams:B,selectedLoraBlockType:g,selectedModelType:T}),e({type:"SET_HISTORY_INDEX",payload:X(l).length-1})),e({type:"LOAD_METADATA",payload:{algorithm:h.algorithm||"Unknown",modelType:h.modelType||"Unknown",baseModel:h.baseModel||"Unknown",selectedModelType:T,usingBlocks:h.usingBlocks,blockGroups:x,lbwPresets:I(T,y.weightState.selectedLoraBlockType),weights:M}})}).catch(h=>{h.name!=="AbortError"&&(console.error("Error fetching metadata:",h),e({type:"SET_WAITING",payload:!1}))})}if(!y.previewState.modelId){let S=Eo();Lo(l,S.signal).then(async h=>{h.thumbUrl!==ve&&(h.thumbUrl=h.thumbUrl),bt(l,h),e({type:"LOAD_PREVIEW_DATA",payload:h})}).catch(h=>{h.name!=="AbortError"&&console.error("Error fetching metadata:",h)})}}function Te(e){let t=Ce();e({type:"CLOSE_CONTEXT",payload:t})}function _n(e,t){window.opts.weight_helper_using_execCommand||fe(e,!0),Te(t)}var Oo=Oe(null),P=()=>{let e=lt(Oo);if(!e)throw new Error("useWeightHelper must be used within a WeightHelperProvider");return e},fn=({weightHelperState:e,children:t})=>{let[o,n]=it(gn,e);return d(Oo.Provider,{value:{state:o,dispatch:n}},t)},gn=(e,t)=>{if(t.type==="OPEN_CONTEXT")return t.payload;if(t.type==="CLOSE_CONTEXT")return t.payload;if(t.type==="SET_POSITION")return{...e,uiState:{...e.uiState,pos:{...e.uiState.pos,top:t.payload.top,left:t.payload.left}}};if(t.type==="LOAD_METADATA"){let o={...e,metadataState:{...e.metadataState,algorithm:t.payload.algorithm||"Unknown",baseModel:t.payload.baseModel||"Unknown",modelType:t.payload.modelType||"Unknown"},weightState:{...e.weightState,selectedModelType:t.payload.selectedModelType,weights:t.payload.weights},blockGroups:t.payload.blockGroups,lbwPresets:t.payload.lbwPresets,uiState:{...e.uiState,isWaiting:!1}};return t.payload.usingBlocks===null?o.usingBlocks=void 0:t.payload.usingBlocks&&(o.usingBlocks=new Set(t.payload.usingBlocks)),o}else{if(t.type==="SET_WAITING")return{...e,uiState:{...e.uiState,isWaiting:t.payload}};if(t.type==="SET_MODELINFO"){let o={...e,weightState:{...e.weightState,selectedLoraBlockType:t.payload.selectedLoraBlockType,selectedModelType:t.payload.selectedModelType,weights:t.payload.weights},blockGroups:t.payload.blockGroups,lbwPresets:t.payload.lbwPresets};return window.opts.weight_helper_using_execCommand||K(W(o.loraName,o.weightState).loraDefine),o}else if(t.type==="TOGGLE_XYZ_MODE"){let o={...e,weightState:{...e.weightState,xyzMode:!e.weightState.xyzMode}};return window.opts.weight_helper_using_execCommand||K(W(o.loraName,o.weightState).loraDefine),o}else if(t.type==="SET_PRESET"){let o={...e.weightState,weights:{...e.weightState.weights,...t.payload.weights}},n=W(e.loraName,o),r=$(e.loraName,n.loraParams),a={...e,weightState:o,preset:t.payload.preset,lock:r};return window.opts.weight_helper_using_execCommand||K(n.loraDefine),a}else if(t.type==="TOGGLE_LOCK_STATUS"){let o=W(e.loraName,e.weightState).loraParams,n=$(e.loraName,o);return n?gt(e.loraName,o):ft(e.loraName,o),{...e,lock:!n}}else if(t.type==="SET_HISTORY"){let{locked:o,historyIndex:n,preset:r}=t.payload,{selectedLoraBlockType:a,selectedModelType:i,weights:l,lbwe:c,xyzMode:p}=t.payload.weightState,f={...e.weightState,weights:{...e.weightState.weights,...l},selectedLoraBlockType:a,selectedModelType:i,lbwe:c,xyzMode:p},s={...e,historyIndex:n,preset:r,weightState:f,lock:o};return window.opts.weight_helper_using_execCommand||K(W(s.loraName,s.weightState).loraDefine),s}else{if(t.type==="SET_HISTORY_INDEX")return{...e,historyIndex:t.payload};if(t.type==="SET_WEIGHT"){let o={...e.weightState.weights,[t.payload.block]:{...e.weightState.weights[t.payload.block],value:t.payload.value,min:Math.min(t.payload.value,e.weightState.weights[t.payload.block].sliderMin),max:Math.max(t.payload.value,e.weightState.weights[t.payload.block].sliderMax),checkState:t.payload.checkState}},n={...e.weightState,weights:o},r=W(e.loraName,n),a=$(e.loraName,r.loraParams),i={...e,weightState:n,preset:Z(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType,e.lbwPresets,o),lock:a};return window.opts.weight_helper_using_execCommand||K(r.loraDefine),i}else{if(t.type==="HIDE_MORE_BUTTON")return{...e,uiState:{...e.uiState,isMoreButtonVisible:!1}};if(t.type==="CLEAR_HISTORY"){_t(e.loraName),e.weightState.xyzMode||ne(e.loraName,{loraParams:W(e.loraName,e.weightState).loraParams,...e.weightState});let o=X(e.loraName).length-1;return{...e,historyIndex:o<0?0:o}}else return t.type==="LOAD_PREVIEW_DATA"?{...e,previewState:t.payload}:t.type==="SET_PREVIEW_DESCRIPTION_VISIBLE"?{...e,previewState:{...e.previewState,isDescriptionVisible:t.payload}}:t.type==="HIDE_TAG_INSERT_BUTTON"?{...e,previewState:{...e.previewState,isTagInsertButtonVisible:!1}}:e}}}};function Ao(e){ot(d(fn,{weightHelperState:e},d(Wo,null)),document.getElementById("weight-helper-container"))}var $e,mn=new Promise(e=>{$e=e});ht();onUiLoaded(()=>{if(!gradioApp().querySelector("#lbw_ratiospreset"))return;let o=[...getComputedStyle(document.documentElement).getPropertyValue("--body-text-color").trim().slice(1).match(/.{1,2}/g).map(n=>parseInt(n,16)),.3];document.documentElement.style.setProperty("--weight-helper-shadow",`rgba(${o.join(",")})`),document.documentElement.style.setProperty("--weight-helper-slider_size",String(window.opts.weight_helper_slider_length)),mn.then(()=>{let n=document.createElement("div");n.id="weight-helper-container",gradioApp().appendChild(n),dt(),Ao(Ce())})});onOptionsChanged(()=>{$e&&($e(!0),$e=null)});})();
//# sourceMappingURL=weight_helper.js.map
