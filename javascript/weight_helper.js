"use strict";(()=>{var T={lora:"lora",lycoris:"lycoris",Unknown:"Unknown"},v={SD:"SD",SDXL:"SDXL",Flux:"Flux",Unknown:"Unknown"},V={te:"te",unet:"unet",start:"start",stop:"stop",step:"step",lbw:"lbw",lbwe:"lbwe"},y={TENC:"TEnc",UNET:"UNet",START:"Start",STOP:"Stop",LBW:"LBW"};var Ge={STABLE_DIFFUSION:["BASE","IN00","IN01","IN02","IN03","IN04","IN05","IN06","IN07","IN08","IN09","IN10","IN11","M00","OUT00","OUT01","OUT02","OUT03","OUT04","OUT05","OUT06","OUT07","OUT08","OUT09","OUT10","OUT11"],BLACK_FOREST_LABS:["CLIP","T5","IN","D00","D01","D02","D03","D04","D05","D06","D07","D08","D09","D10","D11","D12","D13","D14","D15","D16","D17","D18","S00","S01","S02","S03","S04","S05","S06","S07","S08","S09","S10","S11","S12","S13","S14","S15","S16","S17","S18","S19","S20","S21","S22","S23","S24","S25","S26","S27","S28","S29","S30","S31","S32","S33","S34","S35","S36","S37","OUT"]},pe={[v.SD]:Ge.STABLE_DIFFUSION,[v.SDXL]:Ge.STABLE_DIFFUSION,[v.Flux]:Ge.BLACK_FOREST_LABS,[v.Unknown]:[]},pt={[v.SD]:{[T.lora]:[1,0,1,1,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1],[T.lycoris]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[T.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[v.SDXL]:{[T.lora]:[1,0,0,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0],[T.lycoris]:[1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[T.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[v.Flux]:{[T.lora]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[T.lycoris]:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[T.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},[v.Unknown]:{[T.lora]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[T.lycoris]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[T.Unknown]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ut={[v.SD]:{[T.lora]:"XYZ(17)",[T.lycoris]:"XYZ(26)",[T.Unknown]:"XYZ(26)"},[v.SDXL]:{[T.lora]:"XYZ(12)",[T.lycoris]:"XYZ(20)",[T.Unknown]:"XYZ(26)"},[v.Flux]:{[T.lora]:"XYZ(19)",[T.lycoris]:"XYZ(19)",[T.Unknown]:"XYZ(19)"},[v.Unknown]:{[T.lora]:"XYZ(17)",[T.lycoris]:"XYZ(26)",[T.Unknown]:"XYZ(26)"}},ee={"":v.Unknown,SD:v.SD,SDXL:v.SDXL,Flux:v.Flux},te={"":T.Unknown,"LoRA(LierLa)":T.lora,"LyCORIS,etc":T.lycoris},we="./file=html/card-no-preview.png";var ve={[y.TENC]:{min:0,max:0,default:1,step:.5},[y.UNET]:{min:0,max:0,default:0,step:.5},[y.START]:{min:0,max:0,default:0,step:1},[y.STOP]:{min:0,max:0,default:0,step:1},[y.LBW]:{min:0,max:0,default:1,step:.5}},dt={[v.SD]:{[T.lora]:[["BASE","IN01-IN04","IN05-IN08","M00","OUT03-OUT06","OUT07-OUT11"]],[T.lycoris]:[["BASE","IN00-IN05","IN06-IN11","M00","OUT00-OUT05","OUT06-OUT11"]],[T.Unknown]:[[]]},[v.SDXL]:{[T.lora]:[["BASE","IN04-IN08","M00","OUT00-OUT05"]],[T.lycoris]:[["BASE","IN00-IN03","IN04-IN08","M00","OUT00-OUT03","OUT04-OUT08"]],[T.Unknown]:[[]]},[v.Flux]:{[T.lora]:[["CLIP","T5","IN","OUT"],["D00-D18"],["S00-S18"],["S19-S37"]],[T.lycoris]:[["CLIP","T5","IN","OUT"],["D00-D18"],["S00-S18"],["S19-S37"]],[T.Unknown]:[[]]},[v.Unknown]:{[T.lora]:[[]],[T.lycoris]:[[]],[T.Unknown]:[[]]}};function _t(){let e=/((BASE|MID|M00|CLIP|T5|(IN|OUT|D|S)[0-9]{2}(-(IN|OUT|D|S)[0-9]{2})?) *(, *|$))+/;for(let t of Object.values(ee))if(!(t===v.Unknown||t===v.Flux)){for(let o of Object.values(te))if(o!==T.Unknown)try{let n=window.opts[`weight_helper_LBW_${t}_${o}_block_points`];if(n=n.replace("MID","M00"),e.exec(n)){let r=n.split(",").map(a=>a.trim().replace(/\d+/g,i=>i.length===1?`0${i}`:i));dt[t][o]=[r]}}catch(n){console.warn(`${t}_${o} block definition format is invalid.`,n)}}for(let t of[y.TENC,y.UNET,y.LBW])ve[t].min=+window.opts[`weight_helper_${t}_min`],ve[t].max=+window.opts[`weight_helper_${t}_max`],ve[t].step=+window.opts[`weight_helper_${t}_step`]}function k(e){return ve[e]}function be(e){return e in pe?pe[e]:pe[v.Unknown]}function oe(e,t){let o=j(e,t);return pe[e||v.Unknown].filter((n,r)=>o[r]===1)}function j(e,t){return pt[e||v.Unknown][t||T.Unknown]}function F(e,t){return dt[e||v.Unknown][t||T.Unknown]}function ft(e,t){return ut[e||v.Unknown][t||T.Unknown]}var A={},D={};function Y(e){return A[e]??[]}function ne(e,t){t={loraParams:t.loraParams,selectedLoraBlockType:t.selectedLoraBlockType,selectedModelType:t.selectedModelType},e in A?(A[e]=A[e].filter(o=>o.loraParams!==t.loraParams),A[e].push(t)):A[e]=[t]}function gt(e){if(e in A){let t=D[e];A[e]=A[e].filter(o=>t&&t.has(o.loraParams))}}function mt(e,t){e in D?D[e].add(t):D[e]=new Set([t])}function ht(e,t){e in D&&D[e].delete(t)}function $(e,t){return e in D?D[e].has(t):!1}function yt(){localStorage.setItem("wh://histories",JSON.stringify(A));let e={};for(let t in D)e[t]=Array.from(D[t]);localStorage.setItem("wh://locks",JSON.stringify(e))}function St(){let e=localStorage.getItem("wh://histories");e&&(A=JSON.parse(e));let t=localStorage.getItem("wh://locks");if(t){let o=JSON.parse(t);for(let n in o)D[n]=new Set(o[n])}}var Tt={},wt={};function vt(e){return Tt[e]}function bt(e,t){Tt[e]={metadataState:t.metadataState,selectedLoraBlockType:t.weightState.selectedLoraBlockType,selectedModelType:t.weightState.selectedModelType,usingBlocks:t.usingBlocks}}function kt(e){return wt[e]}function Mt(e,t){wt[e]=t}var xt,Et,Ct,Lt,Bt,Pt={},Nt=0;function ue(){return xt}function It(e){xt=e}function de(){return Et}function Ot(e){Et=e}function Ye(){return Ct}function Wt(e){Ct=e}function ze(){return Lt}function ke(e){Lt=e}function At(){return Bt}function Dt(e){Bt=e}function Me(){return Nt||0}function Ut(e){Nt=+gradioApp().querySelector(`div:is([id^='tab_${e}'][class*='tabitem'])`).querySelector('div:is([id$="_steps"]) input[type=number]').value}function N(e,t){return Pt[e||v.Unknown][t||T.Unknown]}function Rt(e){let r=(gradioApp().querySelector(`div:is([id^='tab_${e}'][class*='tabitem'])`).querySelector("#lbw_ratiospreset textarea").value??"").split(`
`).filter(i=>i.trim()!==""),a={};for(let i of Object.values(v)){a[i]={};for(let l of Object.values(T)){let c={},p={};a[i][l]=c;let g=j(i,l).filter(s=>s==1).length;for(let s of r){let f=s.split(":");f.length==2&&f[1].split(",").length==g&&(c[f[0]]=f[1],p[f[1]]=f[0])}}}Pt=a}function Z(e,t,o,n){let r=new Set(oe(e,t)),a=Object.entries(n).filter(([l])=>r.has(l)).map(l=>l[1].value).join(","),i=Object.entries(o).find(([,l])=>l===a);return i?i[0]:""}function xe(e){let t,o=typeof window.TAC_CFG<"u"&&window.TAC_CFG,n,r=typeof window.pilotIsActive<"u"&&window.pilotIsActive;try{o&&(t=window.TAC_CFG.activeIn.global,window.TAC_CFG.activeIn.global=!1),r&&(n=window.pilotIsActive,window.pilotIsActive=!1),e()}finally{o&&(window.TAC_CFG.activeIn.global=t),r&&(window.pilotIsActive=n)}}var Ht=e=>e.toLowerCase(),q=e=>e?{}:{display:"none"},G=e=>e?{}:{visibility:"hidden"},O=(e,t=void 0)=>{if(e.uiState.isWaiting)return!0;switch(t){case y.TENC:case y.UNET:case y.START:case y.STOP:case void 0:return!1}return e.usingBlocks!==void 0&&!e.usingBlocks.has(t)};function Ee(e){let t=[];return e.split(",").map(o=>o.trim()).forEach(o=>{let n=o.match(/^([A-Z]+)(\d+)-\1(\d+)$/);if(!n){t.push(o);return}let[,r,a,i]=n,l=parseInt(a),c=parseInt(i),p=l;for(;t.push(`${r}${p.toString().padStart(2,"0")}`),p!=c;)p+=l<c?1:-1}),t}var Ho=/<(lora|lyco):([^:]+):([^>]+)>/;function Vt(e){let t=e.target;if(!window.opts.weight_helper_enabled)return;let o=window.getSelection()?.toString();if(o)return;let n=t.value,r=t.selectionStart,a=n.lastIndexOf("<",r-1),i=n.indexOf(">",r);if(a<0||i<0||(o=n.substring(a,i+1),(o.match(/</g)||[]).length!=1||(o.match(/>/g)||[]).length!=1))return;r=a;let l=Ho.exec(o);if(l){e.preventDefault();let c=l[1].toLowerCase(),p=l[2],g=l[3],s=t.closest("[id^='tab_'][class*='tabitem']").id.split("_")[1],f=r+l.index,u=f+l.input.trim().length;return{tabId:s,textarea:t,selectionStart:f,selectionEnd:u,namespace:c,loraName:p,loraParams:g,top:e.pageY+15,left:e.pageX}}}function K(e){let t=de(),o=Ye(),n=ze();t.value=t.value.substring(0,o)+e+t.value.substring(n),ke(o+e.length)}function Vo(e){xe(()=>{let t=de(),o=Ye(),n=ze();t.focus(),t.setSelectionRange(o,n),document.execCommand("insertText",!1,e)})}function I(e,t){let o=String(t.weights[y.TENC].value),n=0,r=0;for(let u of[y.UNET]){let h=t.weights[u],m=k(u).default,d=+h.value;(h.checkState||h.checkState===void 0&&d!=m)&&(r===n?o+=`:${d}`:o+=`:${Ht(u)}=${d}`,n++),r++}let a=k(y.START).default,i=t.weights[y.START].value,l=k(y.STOP).default,c=t.weights[y.STOP].value;c<0&&(c=k(y.STOP).default),i!=a&&c!=l?o+=`:step=${i}-${c}`:i!=a?o+=`:start=${i}`:c!=l&&(o+=`:stop=${c}`);let{selectedModelType:p,selectedLoraBlockType:g}=t,s=t.xyzMode,f=o;if(s)o+=":lbw=XYZ",f+=":lbw=XYZ";else if(p!==v.Unknown){let u=j(p,g).map((m,d)=>{if(m===1)return t.weights[be(p)[d]]}).filter(m=>m!==void 0),h=k(y.LBW).default;if(!u.every(m=>m.value===h)){let m=u.map(w=>w.value).join(",");o+=`:lbw=${m}`;let d=N(p,g),S=Object.entries(d).find(([,w])=>m===w);S?f+=`:lbw=${S[0]}`:f+=`:lbw=${m}`}}return t.lbwe&&(o+=`:lbwe=${t.lbwe}`,f+=`:lbwe=${t.lbwe}`),{loraParams:o,loraDefine:`<lora:${e}:${f}>`}}function fe(e,t=!1){let o=I(e.loraName,e.weightState);window.opts.weight_helper_using_execCommand?e.srcLoraParams!==o.loraParams&&Vo(o.loraDefine):t&&K(At()),bt(e.loraName,e),e.weightState.xyzMode||ne(e.loraName,{loraParams:o.loraParams,...e.weightState}),yt()}function Ce(){return{loraName:"",metadataState:void 0,srcLoraParams:"",weightState:{selectedLoraBlockType:T.lora,selectedModelType:v.SD,weights:{},lbwe:"",xyzMode:!1},blockGroups:[],usingBlocks:void 0,preset:"",lbwPresets:{},uiState:{isVisible:!1,scale:1,pos:{top:0,right:0,bottom:0,left:0},isMoreButtonVisible:!0,isWaiting:!1},lock:!1,historyIndex:0,previewState:{modelId:"",triggerWords:[],negativeTriggerWords:[],modelName:"",thumbUrl:"",hasMetadata:!1,description:"",isDescriptionVisible:!1,isTagInsertButtonVisible:!1}}}function Ft(e,t,o,n,r){let a=v.Unknown,i=T.Unknown,l=Y(t);if(l&&l.length>0){let m=l[l.length-1];a=m.selectedModelType??v.Unknown,i=m.selectedLoraBlockType??T.Unknown}let c,p,g=vt(t);g&&(c=g.metadataState,a=g.selectedModelType??v.Unknown,i=g.selectedLoraBlockType??T.Unknown,p=g.usingBlocks);let s=Fo(e,o,a,i),f=N(s.selectedModelType,s.selectedLoraBlockType),u=I(t,s).loraParams,h=!1;for(let m of[y.UNET,y.START,y.STOP]){let d=s.weights[m],S=k(m).default,w=+d.value;if(!(d.checkState||d.checkState===void 0&&w!=S)){h=!0;break}}return{loraName:t,metadataState:c,srcLoraParams:u,weightState:s,blockGroups:F(s.selectedModelType,s.selectedLoraBlockType),usingBlocks:p,uiState:{isVisible:!0,scale:window.opts.weight_helper_context_menu_scale,isMoreButtonVisible:h,isWaiting:!c,pos:{top:n,right:0,bottom:0,left:r}},previewState:$o(t),preset:Z(s.selectedModelType,s.selectedLoraBlockType,f,s.weights),lbwPresets:f,lock:$(t,u),historyIndex:l.length-1}}function Fo(e,t,o,n){let r=Le(t,o,n),{weights:a,lbwe:i,xyzMode:l}=r;return n===T.Unknown&&(n=e==="lora"?T.lora:T.lycoris),{selectedLoraBlockType:n,selectedModelType:o,weights:a,lbwe:i,xyzMode:l}}function Le(e,t,o){let n=e.split(":"),r={};for(let m=0;m<n.length;m++){let d,S;if(n[m].indexOf("=")>=0){let w=n[m].split("=");d=w[0].toLowerCase(),S=w[1]}else d=[V.te,V.unet][m],S=n[m];r[d]=S}let a=[];for(let m of Object.values(ee))for(let d of Object.values(te))a.push({modelType:m,loraBlockType:d,presets:N(m,d),masks:j(m,d)});let i=k(y.TENC).default,l,c=k(y.START).default,p=k(y.STOP).default,g=[],s="",f=!1;Object.entries(r).forEach(([m,d])=>{switch(m){case V.lbw:if(d==="XYZ"){f=!0;break}let S=d.split(",");for(let E of a){if(S.length===1)if(d in E.presets)S=E.presets[d].split(",");else continue;if(S.length===E.masks.filter(M=>M==1).length){t=E.modelType,o=E.loraBlockType;let M=0;for(let L of E.masks)L?(g.push(+S[M]),M++):g.push(0);break}}break;case V.step:let w=d.split("-");c=Math.round(+w[0]),p=Math.round(+w[1]);break;case V.lbwe:s=d;break;case V.te:i=+d;break;case V.unet:l=+d;break;case V.start:c=Math.round(+d);break;case V.stop:p=Math.round(+d);break}});let u=!0;l===void 0&&(l=k(y.UNET).default,u=!1);let h={};if(t!==v.Unknown){let m=be(t);if(g.length===0)for(let d=0;d<m.length;d++)g.push(k(y.LBW).default);g.forEach((d,S)=>{h[m[S]]={initValue:d,value:d,sliderMin:Math.min(d,k(y.LBW).min),sliderMax:Math.max(d,k(y.LBW).max)}})}return{selectedLoraBlockType:o,selectedModelType:t,weights:{[y.TENC]:{initValue:i,value:i,sliderMin:Math.min(i,k(y.TENC).min),sliderMax:Math.max(i,k(y.TENC).max)},[y.UNET]:{initValue:l,value:l,sliderMin:Math.min(l,k(y.UNET).min),sliderMax:Math.max(l,k(y.UNET).max),initCheckState:u,checkState:u},[y.START]:{initValue:c,value:c,sliderMin:Math.min(c,k(y.START).min),sliderMax:Math.max(c,k(y.START).max)},[y.STOP]:{initValue:p,value:p,sliderMin:Math.min(p,k(y.STOP).min),sliderMax:Math.max(p,k(y.STOP).max)},...h},lbwe:s,xyzMode:f}}function $o(e){let t=kt(e);return t||{modelId:"",triggerWords:[""],negativeTriggerWords:[""],modelName:"",thumbUrl:we,hasMetadata:!1,description:"",isDescriptionVisible:!1,isTagInsertButtonVisible:!1}}var Ie,b,Yt,Go,J,$t,zt,jt,Zt,Ke,je,Ze,qt,ge={},Kt=[],Xo=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,me=Array.isArray;function X(e,t){for(var o in t)e[o]=t[o];return e}function Je(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function _(e,t,o){var n,r,a,i={};for(a in t)a=="key"?n=t[a]:a=="ref"?r=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?Ie.call(arguments,2):o),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]==null&&(i[a]=e.defaultProps[a]);return Pe(e,i,n,r,null)}function Pe(e,t,o,n,r){var a={type:e,props:t,key:o,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++Yt,__i:-1,__u:0};return r==null&&b.vnode!=null&&b.vnode(a),a}function B(e){return e.children}function U(e,t){this.props=e,this.context=t}function ae(e,t){if(t==null)return e.__?ae(e.__,e.__i+1):null;for(var o;t<e.__k.length;t++)if((o=e.__k[t])!=null&&o.__e!=null)return o.__e;return typeof e.type=="function"?ae(e):null}function Jt(e){var t,o;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((o=e.__k[t])!=null&&o.__e!=null){e.__e=e.__c.base=o.__e;break}return Jt(e)}}function qe(e){(!e.__d&&(e.__d=!0)&&J.push(e)&&!Ne.__r++||$t!=b.debounceRendering)&&(($t=b.debounceRendering)||zt)(Ne)}function Ne(){for(var e,t,o,n,r,a,i,l=1;J.length;)J.length>l&&J.sort(jt),e=J.shift(),l=J.length,e.__d&&(o=void 0,r=(n=(t=e).__v).__e,a=[],i=[],t.__P&&((o=X({},n)).__v=n.__v+1,b.vnode&&b.vnode(o),Qe(t.__P,o,n,t.__n,t.__P.namespaceURI,32&n.__u?[r]:null,a,r??ae(n),!!(32&n.__u),i),o.__v=n.__v,o.__.__k[o.__i]=o,to(a,o,i),o.__e!=r&&Jt(o)));Ne.__r=0}function Qt(e,t,o,n,r,a,i,l,c,p,g){var s,f,u,h,m,d,S=n&&n.__k||Kt,w=t.length;for(c=Yo(o,t,S,c,w),s=0;s<w;s++)(u=o.__k[s])!=null&&(f=u.__i==-1?ge:S[u.__i]||ge,u.__i=s,d=Qe(e,u,f,r,a,i,l,c,p,g),h=u.__e,u.ref&&f.ref!=u.ref&&(f.ref&&et(f.ref,null,u),g.push(u.ref,u.__c||h,u)),m==null&&h!=null&&(m=h),4&u.__u||f.__k===u.__k?c=eo(u,c,e):typeof u.type=="function"&&d!==void 0?c=d:h&&(c=h.nextSibling),u.__u&=-7);return o.__e=m,c}function Yo(e,t,o,n,r){var a,i,l,c,p,g=o.length,s=g,f=0;for(e.__k=new Array(r),a=0;a<r;a++)(i=t[a])!=null&&typeof i!="boolean"&&typeof i!="function"?(c=a+f,(i=e.__k[a]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?Pe(null,i,null,null,null):me(i)?Pe(B,{children:i},null,null,null):i.constructor==null&&i.__b>0?Pe(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=e,i.__b=e.__b+1,l=null,(p=i.__i=zo(i,o,c,s))!=-1&&(s--,(l=o[p])&&(l.__u|=2)),l==null||l.__v==null?(p==-1&&(r>g?f--:r<g&&f++),typeof i.type!="function"&&(i.__u|=4)):p!=c&&(p==c-1?f--:p==c+1?f++:(p>c?f--:f++,i.__u|=4))):e.__k[a]=null;if(s)for(a=0;a<g;a++)(l=o[a])!=null&&!(2&l.__u)&&(l.__e==n&&(n=ae(l)),no(l,l));return n}function eo(e,t,o){var n,r;if(typeof e.type=="function"){for(n=e.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=e,t=eo(n[r],t,o));return t}e.__e!=t&&(t&&e.type&&!o.contains(t)&&(t=ae(e)),o.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function he(e,t){return t=t||[],e==null||typeof e=="boolean"||(me(e)?e.some(function(o){he(o,t)}):t.push(e)),t}function zo(e,t,o,n){var r,a,i=e.key,l=e.type,c=t[o];if(c===null&&e.key==null||c&&i==c.key&&l==c.type&&!(2&c.__u))return o;if(n>(c!=null&&!(2&c.__u)?1:0))for(r=o-1,a=o+1;r>=0||a<t.length;){if(r>=0){if((c=t[r])&&!(2&c.__u)&&i==c.key&&l==c.type)return r;r--}if(a<t.length){if((c=t[a])&&!(2&c.__u)&&i==c.key&&l==c.type)return a;a++}}return-1}function Gt(e,t,o){t[0]=="-"?e.setProperty(t,o??""):e[t]=o==null?"":typeof o!="number"||Xo.test(t)?o:o+"px"}function Be(e,t,o,n,r){var a;e:if(t=="style")if(typeof o=="string")e.style.cssText=o;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)o&&t in o||Gt(e.style,t,"");if(o)for(t in o)n&&o[t]==n[t]||Gt(e.style,t,o[t])}else if(t[0]=="o"&&t[1]=="n")a=t!=(t=t.replace(Zt,"$1")),t=t.toLowerCase()in e||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=o,o?n?o.u=n.u:(o.u=Ke,e.addEventListener(t,a?Ze:je,a)):e.removeEventListener(t,a?Ze:je,a);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=o??"";break e}catch{}typeof o=="function"||(o==null||o===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&o==1?"":o))}}function Xt(e){return function(t){if(this.l){var o=this.l[t.type+e];if(t.t==null)t.t=Ke++;else if(t.t<o.u)return;return o(b.event?b.event(t):t)}}}function Qe(e,t,o,n,r,a,i,l,c,p){var g,s,f,u,h,m,d,S,w,E,M,L,R,ct,Te,le,$e,H=t.type;if(t.constructor!=null)return null;128&o.__u&&(c=!!(32&o.__u),a=[l=t.__e=o.__e]),(g=b.__b)&&g(t);e:if(typeof H=="function")try{if(S=t.props,w="prototype"in H&&H.prototype.render,E=(g=H.contextType)&&n[g.__c],M=g?E?E.props.value:g.__:n,o.__c?d=(s=t.__c=o.__c).__=s.__E:(w?t.__c=s=new H(S,M):(t.__c=s=new U(S,M),s.constructor=H,s.render=Zo),E&&E.sub(s),s.props=S,s.state||(s.state={}),s.context=M,s.__n=n,f=s.__d=!0,s.__h=[],s._sb=[]),w&&s.__s==null&&(s.__s=s.state),w&&H.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=X({},s.__s)),X(s.__s,H.getDerivedStateFromProps(S,s.__s))),u=s.props,h=s.state,s.__v=t,f)w&&H.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),w&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(w&&H.getDerivedStateFromProps==null&&S!==u&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(S,M),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(S,s.__s,M)===!1||t.__v==o.__v){for(t.__v!=o.__v&&(s.props=S,s.state=s.__s,s.__d=!1),t.__e=o.__e,t.__k=o.__k,t.__k.some(function(ce){ce&&(ce.__=t)}),L=0;L<s._sb.length;L++)s.__h.push(s._sb[L]);s._sb=[],s.__h.length&&i.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(S,s.__s,M),w&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(u,h,m)})}if(s.context=M,s.props=S,s.__P=e,s.__e=!1,R=b.__r,ct=0,w){for(s.state=s.__s,s.__d=!1,R&&R(t),g=s.render(s.props,s.state,s.context),Te=0;Te<s._sb.length;Te++)s.__h.push(s._sb[Te]);s._sb=[]}else do s.__d=!1,R&&R(t),g=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++ct<25);s.state=s.__s,s.getChildContext!=null&&(n=X(X({},n),s.getChildContext())),w&&!f&&s.getSnapshotBeforeUpdate!=null&&(m=s.getSnapshotBeforeUpdate(u,h)),le=g,g!=null&&g.type===B&&g.key==null&&(le=oo(g.props.children)),l=Qt(e,me(le)?le:[le],t,o,n,r,a,i,l,c,p),s.base=t.__e,t.__u&=-161,s.__h.length&&i.push(s),d&&(s.__E=s.__=null)}catch(ce){if(t.__v=null,c||a!=null)if(ce.then){for(t.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,t.__e=l}else for($e=a.length;$e--;)Je(a[$e]);else t.__e=o.__e,t.__k=o.__k;b.__e(ce,t,o)}else a==null&&t.__v==o.__v?(t.__k=o.__k,t.__e=o.__e):l=t.__e=jo(o.__e,t,o,n,r,a,i,c,p);return(g=b.diffed)&&g(t),128&t.__u?void 0:l}function to(e,t,o){for(var n=0;n<o.length;n++)et(o[n],o[++n],o[++n]);b.__c&&b.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(a){a.call(r)})}catch(a){b.__e(a,r.__v)}})}function oo(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:me(e)?e.map(oo):X({},e)}function jo(e,t,o,n,r,a,i,l,c){var p,g,s,f,u,h,m,d=o.props,S=t.props,w=t.type;if(w=="svg"?r="http://www.w3.org/2000/svg":w=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),a!=null){for(p=0;p<a.length;p++)if((u=a[p])&&"setAttribute"in u==!!w&&(w?u.localName==w:u.nodeType==3)){e=u,a[p]=null;break}}if(e==null){if(w==null)return document.createTextNode(S);e=document.createElementNS(r,w,S.is&&S),l&&(b.__m&&b.__m(t,a),l=!1),a=null}if(w==null)d===S||l&&e.data==S||(e.data=S);else{if(a=a&&Ie.call(e.childNodes),d=o.props||ge,!l&&a!=null)for(d={},p=0;p<e.attributes.length;p++)d[(u=e.attributes[p]).name]=u.value;for(p in d)if(u=d[p],p!="children"){if(p=="dangerouslySetInnerHTML")s=u;else if(!(p in S)){if(p=="value"&&"defaultValue"in S||p=="checked"&&"defaultChecked"in S)continue;Be(e,p,null,u,r)}}for(p in S)u=S[p],p=="children"?f=u:p=="dangerouslySetInnerHTML"?g=u:p=="value"?h=u:p=="checked"?m=u:l&&typeof u!="function"||d[p]===u||Be(e,p,u,d[p],r);if(g)l||s&&(g.__html==s.__html||g.__html==e.innerHTML)||(e.innerHTML=g.__html),t.__k=[];else if(s&&(e.innerHTML=""),Qt(t.type=="template"?e.content:e,me(f)?f:[f],t,o,n,w=="foreignObject"?"http://www.w3.org/1999/xhtml":r,a,i,a?a[0]:o.__k&&ae(o,0),l,c),a!=null)for(p=a.length;p--;)Je(a[p]);l||(p="value",w=="progress"&&h==null?e.removeAttribute("value"):h!=null&&(h!==e[p]||w=="progress"&&!h||w=="option"&&h!=d[p])&&Be(e,p,h,d[p],r),p="checked",m!=null&&m!=e[p]&&Be(e,p,m,d[p],r))}return e}function et(e,t,o){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(r){b.__e(r,o)}}function no(e,t,o){var n,r;if(b.unmount&&b.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||et(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(a){b.__e(a,t)}n.base=n.__P=null}if(n=e.__k)for(r=0;r<n.length;r++)n[r]&&no(n[r],t,o||typeof e.type!="function");o||Je(e.__e),e.__c=e.__=e.__e=void 0}function Zo(e,t,o){return this.constructor(e,o)}function tt(e,t,o){var n,r,a,i;t==document&&(t=document.documentElement),b.__&&b.__(e,t),r=(n=typeof o=="function")?null:o&&o.__k||t.__k,a=[],i=[],Qe(t,e=(!n&&o||t).__k=_(B,null,[e]),r||ge,ge,t.namespaceURI,!n&&o?[o]:r?null:t.firstChild?Ie.call(t.childNodes):null,a,!n&&o?o:r?r.__e:t.firstChild,n,i),to(a,e,i)}function Oe(e){function t(o){var n,r;return this.getChildContext||(n=new Set,(r={})[t.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(a){this.props.value!=a.value&&n.forEach(function(i){i.__e=!0,qe(i)})},this.sub=function(a){n.add(a);var i=a.componentWillUnmount;a.componentWillUnmount=function(){n&&n.delete(a),i&&i.call(a)}}),o.children}return t.__c="__cC"+qt++,t.__=e,t.Provider=t.__l=(t.Consumer=function(o,n){return o.children(n)}).contextType=t,t}Ie=Kt.slice,b={__e:function(e,t,o,n){for(var r,a,i;t=t.__;)if((r=t.__c)&&!r.__)try{if((a=r.constructor)&&a.getDerivedStateFromError!=null&&(r.setState(a.getDerivedStateFromError(e)),i=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,n||{}),i=r.__d),i)return r.__E=r}catch(l){e=l}throw e}},Yt=0,Go=function(e){return e!=null&&e.constructor==null},U.prototype.setState=function(e,t){var o;o=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=X({},this.state),typeof e=="function"&&(e=e(X({},o),this.props)),e&&X(o,e),e!=null&&this.__v&&(t&&this._sb.push(t),qe(this))},U.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),qe(this))},U.prototype.render=B,J=[],zt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,jt=function(e,t){return e.__v.__b-t.__v.__b},Ne.__r=0,Zt=/(PointerCapture)$|Capture$/i,Ke=0,je=Xt(!1),Ze=Xt(!0),qt=0;var ie,x,ot,ro,nt=0,_o=[],C=b,ao=C.__b,io=C.__r,so=C.diffed,lo=C.__c,co=C.unmount,po=C.__;function Ae(e,t){C.__h&&C.__h(x,e,nt||t),nt=0;var o=x.__H||(x.__H={__:[],__h:[]});return e>=o.__.length&&o.__.push({}),o.__[e]}function at(e,t,o){var n=Ae(ie++,2);if(n.t=e,!n.__c&&(n.__=[o?o(t):Jo(void 0,t),function(l){var c=n.__N?n.__N[0]:n.__[0],p=n.t(c,l);c!==p&&(n.__N=[p,n.__[1]],n.__c.setState({}))}],n.__c=x,!x.__f)){var r=function(l,c,p){if(!n.__c.__H)return!0;var g=n.__c.__H.__.filter(function(f){return!!f.__c});if(g.every(function(f){return!f.__N}))return!a||a.call(this,l,c,p);var s=n.__c.props!==l;return g.forEach(function(f){if(f.__N){var u=f.__[0];f.__=f.__N,f.__N=void 0,u!==f.__[0]&&(s=!0)}}),a&&a.call(this,l,c,p)||s};x.__f=!0;var a=x.shouldComponentUpdate,i=x.componentWillUpdate;x.componentWillUpdate=function(l,c,p){if(this.__e){var g=a;a=void 0,r(l,c,p),a=g}i&&i.call(this,l,c,p)},x.shouldComponentUpdate=r}return n.__N||n.__}function it(e,t){var o=Ae(ie++,3);!C.__s&&go(o.__H,t)&&(o.__=e,o.u=t,x.__H.__h.push(o))}function se(e){return nt=5,fo(function(){return{current:e}},[])}function fo(e,t){var o=Ae(ie++,7);return go(o.__H,t)&&(o.__=e(),o.__H=t,o.__h=e),o.__}function st(e){var t=x.context[e.__c],o=Ae(ie++,9);return o.c=e,t?(o.__==null&&(o.__=!0,t.sub(x)),t.props.value):e.__}function qo(){for(var e;e=_o.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(We),e.__H.__h.forEach(rt),e.__H.__h=[]}catch(t){e.__H.__h=[],C.__e(t,e.__v)}}C.__b=function(e){x=null,ao&&ao(e)},C.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),po&&po(e,t)},C.__r=function(e){io&&io(e),ie=0;var t=(x=e.__c).__H;t&&(ot===x?(t.__h=[],x.__h=[],t.__.forEach(function(o){o.__N&&(o.__=o.__N),o.u=o.__N=void 0})):(t.__h.forEach(We),t.__h.forEach(rt),t.__h=[],ie=0)),ot=x},C.diffed=function(e){so&&so(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(_o.push(t)!==1&&ro===C.requestAnimationFrame||((ro=C.requestAnimationFrame)||Ko)(qo)),t.__H.__.forEach(function(o){o.u&&(o.__H=o.u),o.u=void 0})),ot=x=null},C.__c=function(e,t){t.some(function(o){try{o.__h.forEach(We),o.__h=o.__h.filter(function(n){return!n.__||rt(n)})}catch(n){t.some(function(r){r.__h&&(r.__h=[])}),t=[],C.__e(n,o.__v)}}),lo&&lo(e,t)},C.unmount=function(e){co&&co(e);var t,o=e.__c;o&&o.__H&&(o.__H.__.forEach(function(n){try{We(n)}catch(r){t=r}}),o.__H=void 0,t&&C.__e(t,o.__v))};var uo=typeof requestAnimationFrame=="function";function Ko(e){var t,o=function(){clearTimeout(n),uo&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(o,100);uo&&(t=requestAnimationFrame(o))}function We(e){var t=x,o=e.__c;typeof o=="function"&&(e.__c=void 0,o()),x=t}function rt(e){var t=x;e.__c=e.__(),x=t}function go(e,t){return!e||e.length!==t.length||t.some(function(o,n){return o!==e[n]})}function Jo(e,t){return typeof t=="function"?t(e):t}function en(e,t){for(var o in t)e[o]=t[o];return e}function mo(e,t){for(var o in e)if(o!=="__source"&&!(o in t))return!0;for(var n in t)if(n!=="__source"&&e[n]!==t[n])return!0;return!1}function ho(e,t){this.props=e,this.context=t}(ho.prototype=new U).isPureReactComponent=!0,ho.prototype.shouldComponentUpdate=function(e,t){return mo(this.props,e)||mo(this.state,t)};var yo=b.__b;b.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),yo&&yo(e)};var jn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var tn=b.__e;b.__e=function(e,t,o,n){if(e.then){for(var r,a=t;a=a.__;)if((r=a.__c)&&r.__c)return t.__e==null&&(t.__e=o.__e,t.__k=o.__k),r.__c(e,t)}tn(e,t,o,n)};var So=b.unmount;function Mo(e,t,o){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),e.__c.__H=null),(e=en({},e)).__c!=null&&(e.__c.__P===o&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(n){return Mo(n,t,o)})),e}function xo(e,t,o){return e&&o&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(n){return xo(n,t,o)}),e.__c&&e.__c.__P===t&&(e.__e&&o.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=o)),e}function lt(){this.__u=0,this.o=null,this.__b=null}function Eo(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function De(){this.i=null,this.l=null}b.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),So&&So(e)},(lt.prototype=new U).__c=function(e,t){var o=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(o);var r=Eo(n.__v),a=!1,i=function(){a||(a=!0,o.__R=null,r?r(l):l())};o.__R=i;var l=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=xo(c,c.__c.__P,c.__c.__O)}var p;for(n.setState({__a:n.__b=null});p=n.o.pop();)p.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),e.then(i,i)},lt.prototype.componentWillUnmount=function(){this.o=[]},lt.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var o=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Mo(this.__b,o,n.__O=n.__P)}this.__b=null}var r=t.__a&&_(B,null,e.fallback);return r&&(r.__u&=-33),[_(B,null,t.__a?null:e.children),r]};var To=function(e,t,o){if(++o[1]===o[0]&&e.l.delete(t),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(o=e.i;o;){for(;o.length>3;)o.pop()();if(o[1]<o[0])break;e.i=o=o[2]}};(De.prototype=new U).__a=function(e){var t=this,o=Eo(t.__v),n=t.l.get(e);return n[0]++,function(r){var a=function(){t.props.revealOrder?(n.push(r),To(t,e,n)):r()};o?o(a):a()}},De.prototype.render=function(e){this.i=null,this.l=new Map;var t=he(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&t.reverse();for(var o=t.length;o--;)this.l.set(t[o],this.i=[1,0,this.i]);return e.children},De.prototype.componentDidUpdate=De.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(t,o){To(e,o,t)})};var on=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,nn=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,rn=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,an=/[A-Z0-9]/g,sn=typeof document<"u",ln=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};U.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(U.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var wo=b.event;function cn(){}function pn(){return this.cancelBubble}function un(){return this.defaultPrevented}b.event=function(e){return wo&&(e=wo(e)),e.persist=cn,e.isPropagationStopped=pn,e.isDefaultPrevented=un,e.nativeEvent=e};var Co,dn={enumerable:!1,configurable:!0,get:function(){return this.class}},vo=b.vnode;b.vnode=function(e){typeof e.type=="string"&&function(t){var o=t.props,n=t.type,r={},a=n.indexOf("-")===-1;for(var i in o){var l=o[i];if(!(i==="value"&&"defaultValue"in o&&l==null||sn&&i==="children"&&n==="noscript"||i==="class"||i==="className")){var c=i.toLowerCase();i==="defaultValue"&&"value"in o&&o.value==null?i="value":i==="download"&&l===!0?l="":c==="translate"&&l==="no"?l=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?i="ondblclick":c!=="onchange"||n!=="input"&&n!=="textarea"||ln(o.type)?c==="onfocus"?i="onfocusin":c==="onblur"?i="onfocusout":rn.test(i)&&(i=c):c=i="oninput":a&&nn.test(i)?i=i.replace(an,"-$&").toLowerCase():l===null&&(l=void 0),c==="oninput"&&r[i=c]&&(i="oninputCapture"),r[i]=l}}n=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=he(o.children).forEach(function(p){p.props.selected=r.value.indexOf(p.props.value)!=-1})),n=="select"&&r.defaultValue!=null&&(r.value=he(o.children).forEach(function(p){p.props.selected=r.multiple?r.defaultValue.indexOf(p.props.value)!=-1:r.defaultValue==p.props.value})),o.class&&!o.className?(r.class=o.class,Object.defineProperty(r,"className",dn)):(o.className&&!o.class||o.class&&o.className)&&(r.class=r.className=o.className),t.props=r}(e),e.$$typeof=on,vo&&vo(e)};var bo=b.__r;b.__r=function(e){bo&&bo(e),Co=e.__c};var ko=b.diffed;b.diffed=function(e){ko&&ko(e);var t=e.props,o=e.__e;o!=null&&e.type==="textarea"&&"value"in t&&t.value!==o.value&&(o.value=t.value==null?"":t.value),Co=null};var Ue=null,Re=null;function He(){return Ue&&Ue.abort(),Ue=new AbortController,Ue}function Lo(){return Re&&Re.abort(),Re=new AbortController,Re}async function Ve(e,t,o){let n=await fetch(`/whapi/v1/get_metadata?key=${encodeURIComponent(e)}&force=${t}`,{method:"POST",signal:o});if(!n.ok)throw new Error(`Failed to set up API endpoints. Please reload the page.: ${n.status}`);return await n.json()}async function Bo(e,t){let o=await fetch(`/whapi/v1/get_preview_info?key=${encodeURIComponent(e)}`,{method:"POST",signal:t});if(!o.ok)throw new Error(`Failed to set up API endpoints. Please reload the page.: ${o.status}`);return{...await o.json(),isDescriptionVisible:!1,isTagInsertButtonVisible:!0}}function Q(e,t){let o={...e},n=[];return t.forEach(r=>{r.forEach(a=>{Ee(a).forEach(l=>{n.includes(l)||n.push(l)})})}),n.forEach(r=>{o[r]||(o[r]={initValue:k(y.LBW).default,value:k(y.LBW).default,sliderMin:k(y.LBW).min,sliderMax:k(y.LBW).max})}),o}var ye=({label:e,values:t})=>{let{state:o,dispatch:n}=P(),r=k(e)??k(y.LBW),a=p=>{let g=p.target;n({type:"SET_WEIGHT",payload:{block:e,value:o.weightState.weights[e].value,checkState:g.checked}})},i=p=>{let s=+p.target.value/100,f=o.weightState.weights[e].checkState;f!==void 0&&(f=!0),n({type:"SET_WEIGHT",payload:{block:e,value:s,checkState:f}})},l=p=>{let s=+p.target.value,f=o.weightState.weights[e].checkState;f!==void 0&&(f=!0),n({type:"SET_WEIGHT",payload:{block:e,value:s,checkState:f}})},c=t[e];return _(B,{key:e},_("span",null,_("label",null,e),o.weightState.weights[e].checkState!==void 0&&_("input",{type:"checkbox",checked:o.weightState.weights[e].checkState,onChange:a})),_("div",{className:"f f-c g-4"},_("input",{className:"slider",type:"range",value:Math.round(c.value*100),min:Math.round(c.sliderMin*100),max:Math.round(c.sliderMax*100),step:Math.round(r.step*100),disabled:O(o,e),onChange:i}),_("input",{className:"value",type:"number",value:+c.value,step:r.step,disabled:O(o,e),onChange:l})))};var Po=({loraName:e,lock:t})=>{let{state:o,dispatch:n}=P(),r=Y(o.loraName),a=se(!1),i=se({x:0,y:0}),l=h=>{a.current=!0,i.current={x:h.clientX-o.uiState.pos.left+window.scrollX,y:h.clientY-o.uiState.pos.top+window.scrollY},document.addEventListener("mousemove",c),document.addEventListener("mouseup",p)},c=h=>{if(!a.current)return;let m=h.clientX-i.current.x+window.scrollX,d=h.clientY-i.current.y+window.scrollY;n({type:"SET_POSITION",payload:{top:d,left:m}})},p=()=>{a.current=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",p)},g=()=>{n({type:"CLEAR_HISTORY"})},s=()=>{n({type:"TOGGLE_LOCK_STATUS"})},f=()=>{let h=Math.max(0,o.historyIndex-1),m=r[h],d=Le(m.loraParams,m.selectedModelType,m.selectedLoraBlockType),S=$(o.loraName,m.loraParams),w=Z(m.selectedModelType,m.selectedLoraBlockType,o.lbwPresets,d.weights);n({type:"SET_HISTORY",payload:{historyIndex:h,weightState:d,locked:S,preset:w}})},u=()=>{let h=Math.min(r.length-1,o.historyIndex+1),m=r[h],d=Le(m.loraParams,m.selectedModelType,m.selectedLoraBlockType),S=$(o.loraName,m.loraParams),w=Z(m.selectedModelType,m.selectedLoraBlockType,o.lbwPresets,d.weights);n({type:"SET_HISTORY",payload:{historyIndex:h,weightState:d,locked:S,preset:w}})};return _("header",{onMouseDown:l},_("span",null,_("span",{className:`lock ${t?"like":"unlike"}`,style:G(!o.weightState.xyzMode),onClick:s},_("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},_("path",{d:"M21,10H19V7A7,7,0,0,0,5,7v3H3a1,1,0,0,0-1,1v9a4,4,0,0,0,4,4H18a4,4,0,0,0,4-4V11A1,1,0,0,0,21,10Zm-9,9.5A2.5,2.5,0,1,1,14.5,17,2.5,2.5,0,0,1,12,19.5ZM15,10H9V7a3,3,0,0,1,6,0v3Z"}))),_("label",{className:"name"},e)),_("div",{className:"history",style:q(r.length>1)},_("a",{className:"icon",onClick:g},"clear"),_("div",{className:"page"},_("a",{className:"icon",onClick:f,style:G(o.historyIndex>0)},"<"),_("label",{className:"page-label"},o.historyIndex+1+"/"+r.length),_("a",{className:"icon",onClick:u,style:G(o.historyIndex<r.length-1)},">"))))};var No=()=>{let{state:e}=P(),{blockGroups:t,weightState:o}=e,{selectedModelType:n,selectedLoraBlockType:r}=o,a=new Set(oe(n,r));return _("div",{class:"lbw-column"},t.map(i=>_("div",{className:"f col g-2",key:`${n}-${r}-${e.usingBlocks}`,style:{display:"flex"}},i.map(l=>_("div",{className:"border p f g-2 col",key:`${l}-${n}-${r}-${e.usingBlocks}`},Ee(l).map(c=>a.has(c)&&o.weights[c]&&_("div",{class:"f g-2",key:`${c}-${n}-${r}-${O(e,c)}`},_(ye,{label:c,values:o.weights}))))))))};var Io=()=>{let{state:e,dispatch:t}=P(),o=i=>{let c=i.target.value,p=F(e.weightState.selectedModelType,c),g=N(e.weightState.selectedModelType,c),s=Q(e.weightState.weights,p);t({type:"SET_MODELINFO",payload:{selectedLoraBlockType:c,selectedModelType:e.weightState.selectedModelType,blockGroups:p,lbwPresets:g,weights:s}})},n=i=>{let c=i.target.value,p=F(c,e.weightState.selectedLoraBlockType),g=N(c,e.weightState.selectedLoraBlockType),s=Q(e.weightState.weights,p);t({type:"SET_MODELINFO",payload:{selectedModelType:c,selectedLoraBlockType:e.weightState.selectedLoraBlockType,blockGroups:p,lbwPresets:g,weights:s}})},r=()=>{t({type:"TOGGLE_XYZ_MODE"})},a=i=>{let l=i.target,c=l.value;if(c===""&&(c=e.preset,c===""))return;let p=N(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType)[c].split(",").map(f=>+f),g={};oe(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType).forEach((f,u)=>{g[f]={initValue:e.weightState.weights[f].initValue,value:p[u],sliderMin:Math.min(p[u],e.weightState.weights[f].sliderMin),sliderMax:Math.max(p[u],e.weightState.weights[f].sliderMax)}}),t({type:"SET_PRESET",payload:{weights:g,preset:l.value}})};return _(B,null,_("div",{className:"f g-2 f-end"},_("select",{value:e.weightState.selectedModelType,style:{flexGrow:1},disabled:O(e),onChange:n},Object.entries(ee).map(([i,l])=>_("option",{value:l},i))),_("select",{value:e.weightState.selectedLoraBlockType,style:{flexGrow:1},disabled:O(e),onChange:o},Object.entries(te).map(([i,l])=>_("option",{value:l},i)))),_("div",{className:"f g-2 f-end"},_("select",{value:e.preset,style:{flexGrow:1},disabled:O(e),onChange:a},_("option",{value:""}),Object.keys(e.lbwPresets).map(i=>_("option",{value:i},i))),_("div",{className:"p f g-2 f-end"},_("div",{className:"f g-2 f-end"},_("input",{id:"wh:xyz",value:"XYZ",type:"checkbox",checked:e.weightState.xyzMode,disabled:O(e),onChange:r}),_("label",{className:"radio-label",htmlFor:"wh:xyz"},ft(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType))))))};var Oo=()=>{let{state:e,dispatch:t}=P(),o=()=>{if(e.uiState.isWaiting)return;let n=He();t({type:"SET_WAITING",payload:!0}),Ve(e.loraName,!0,n.signal).then(r=>{let a=e.weightState.selectedModelType;(!a||a===v.Unknown)&&(a=r.modelType??v.Unknown);let i=F(a,e.weightState.selectedLoraBlockType),l=Q(e.weightState.weights,i);t({type:"LOAD_METADATA",payload:{algorithm:r.algorithm||"Unknown",modelType:r.modelType||"Unknown",baseModel:r.baseModel||"Unknown",selectedModelType:a,usingBlocks:r.usingBlocks,blockGroups:i,lbwPresets:N(a,e.weightState.selectedLoraBlockType),weights:l}})}).catch(r=>{r.name!=="AbortError"&&(console.error("Error fetching metadata:",r),t({type:"SET_WAITING",payload:!1}))})};return _("span",{className:"metadata"},_("span",null,_("span",null,"Model"),_("span",null,e.metadataState?.modelType||"Unknown")),_("span",null,_("span",null,"Base"),_("span",null,e.metadataState?.baseModel||"Unknown")),_("a",{className:"icon mini svg",onClick:o},_("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 492 492"},_("g",null,_("path",{d:"M484.08,296.216c-5.1-5.128-11.848-7.936-19.032-7.936H330.516c-14.828,0-26.86,12.036-26.86,26.868v22.796c0,7.168,2.784,14.064,7.884,19.16c5.092,5.088,11.82,8.052,18.976,8.052H366.1c-31.544,30.752-74.928,50.08-120.388,50.08c-71.832,0-136.028-45.596-159.744-113.344c-5.392-15.404-19.972-25.784-36.28-25.784c-4.316,0-8.592,0.708-12.7,2.144c-9.692,3.396-17.48,10.352-21.932,19.596c-4.456,9.248-5.04,19.684-1.648,29.368c34.496,98.54,127.692,164.74,232.144,164.74c64.132,0,123.448-23.948,169.572-67.656v25.22c0,14.836,12.384,27.108,27.224,27.108h22.792c14.84,0,26.86-12.272,26.86-27.108V315.24C492,308.056,489.2,301.304,484.08,296.216z"})),_("g",null,_("path",{d:"M478.628,164.78C444.132,66.244,350.916,0.044,246.464,0.044c-64.136,0-123.464,23.952-169.588,67.66v-25.22c0-14.832-12.344-27.112-27.184-27.112H26.896C12.06,15.372,0,27.652,0,42.484V176.76c0,7.18,2.824,13.868,7.944,18.964c5.096,5.128,11.86,7.932,19.044,7.932l-0.08,0.06h134.604c14.84,0,26.832-12.028,26.832-26.86v-22.8c0-14.836-11.992-27.216-26.832-27.216h-35.576c31.544-30.752,74.932-50.076,120.392-50.076c71.832,0,136.024,45.596,159.74,113.348c5.392,15.404,19.968,25.78,36.28,25.78c4.32,0,8.588-0.704,12.7-2.144c9.696-3.396,17.48-10.348,21.932-19.596C481.432,184.9,482.02,174.472,478.628,164.78z"})))))};var Wo=({preview:e,topComponent:t})=>{let{state:o,dispatch:n}=P(),r=u=>{extraNetworksRequestMetadata(u,"lora",e.modelName)},a=u=>{extraNetworksEditUserMetadata(u,ue(),"lora",o.previewState.modelName)},i=()=>{window.open(`https://civitai.com/models/${e.modelId}`,"_blank")},l=()=>{n({type:"SET_PREVIEW_DESCRIPTION_VISIBLE",payload:!0})},c=()=>{n({type:"SET_PREVIEW_DESCRIPTION_VISIBLE",payload:!1})},p=()=>{let u=ue(),h=document.querySelector(`#${u}_prompt textarea`),m=document.querySelector(`#${u}_neg_prompt textarea`),d=de();if(d===m||d!==h&&(h=d,m=void 0),!window.opts.weight_helper_using_execCommand)(()=>{let w=[{triggerWords:e.triggerWords,textarea:h},{triggerWords:e.negativeTriggerWords,textarea:m}];for(let{triggerWords:E,textarea:M}of w)if(E.length>0&&M){let L=E.join(", ");M.value&&(L=", "+L),M.value+=L}})();else{let S=()=>{let w=[{triggerWords:e.triggerWords,textarea:h},{triggerWords:e.negativeTriggerWords,textarea:m}];for(let{triggerWords:E,textarea:M}of w)if(E.length>0&&M){let L=E.join(", ");M.value&&(L=", "+L),M.focus();let R=M.value.length;M.setSelectionRange(R,R),document.execCommand("insertText",!1,L)}};xe(()=>{S()})}n({type:"HIDE_TAG_INSERT_BUTTON"})},g=+(t?.clientWidth||0),s=6,f={};switch(window.opts.weight_helper_preview_position){case"Bottom Right":f.bottom="0px",f.left=g+s+"px";break;case"Top Left":f.top="0px",f.right=g-s+"px";break;case"Bottom Left":f.right=g-s+"px",f.bottom="0px";break;default:f.top="0px",f.left=g+s+"px";break}return _("div",{className:"preview-pane card","data-name":e.modelName,style:{...f}},_("img",{className:"preview",src:e.thumbUrl,style:{height:`${window.opts.weight_helper_preview_height}px`}}),_("div",{className:"action-row button-top",style:G(!e.isDescriptionVisible)},e.modelName&&e.hasMetadata&&typeof extraNetworksRequestMetadata=="function"&&_("div",{className:"metadata-btn card-btn",title:"Show internal metadata",onClick:r}),e.modelName&&typeof extraNetworksEditUserMetadata=="function"&&_("div",{className:"edit-btn card-btn",title:"Edit metadata",onClick:a}),e.modelId&&_("div",{className:"civitai-btn card-btn",title:"Open civitai",onClick:i}),(e.triggerWords.length>0||e.negativeTriggerWords.length>0)&&_("div",{className:"add-trigger-btn card-btn",title:"Add trigger words",onClick:p,style:q(e.isTagInsertButtonVisible)})),e.description&&_(B,null,_("div",{className:"action-row button-bottom",style:G(!e.isDescriptionVisible)},_("div",{className:"card-btn note-btn",onClick:l})),_("textarea",{className:"description",style:G(e.isDescriptionVisible)},e.description),_("div",{className:"card-btn description-close-btn",style:G(e.isDescriptionVisible),onClick:c})))};var Ao=()=>{let{state:e,dispatch:t}=P(),{uiState:o,weightState:n,lock:r,previewState:a}=e;it(()=>{let l=()=>{e.uiState.isVisible&&(Se(t),fe(e))},c=gradioApp().querySelectorAll("button:is([id*='_generate'])");c.forEach(u=>{u.addEventListener("click",l,!0)});let p=u=>{if(e.uiState.isVisible){u.preventDefault(),Se(t),fe(e);return}let h=Vt(u);h&&(u.preventDefault(),_n(t,h))},g=gradioApp().querySelectorAll("*:is([id*='_toprow'] [id*='_prompt'], .prompt) textarea");g.forEach(u=>{u.addEventListener("contextmenu",p)});let s=u=>{if(e.uiState.isVisible){let h=document.getElementById("weight-helper");if(!h)return;let m=ue();if(u){let d=u.target;if(h.contains(d)||d.id===`${m}_token_button`||d.id===`${m}_lora_edit_user_metadata_button`||d.className==="global-popup-close")return;if(d.id.indexOf("_interrupt")>0){Se(t);return}}Se(t),fe(e)}};document.addEventListener("click",s);let f=u=>{u.key==="Escape"&&fn(e,t)};return document.addEventListener("keyup",f),()=>{c.forEach(u=>{u.removeEventListener("click",l,!0)}),g.forEach(u=>{u.removeEventListener("contextmenu",p)}),document.removeEventListener("click",s),document.removeEventListener("keyup",f)}},[e]);let i=se(null);return _("div",{id:"weight-helper",ref:i,className:e.uiState.isWaiting?"waiting":"",style:{transform:`scale(${o.scale})`,top:`${o.pos.top}px`,left:`${o.pos.left}px`,...q(o.isVisible)}},_(Po,{loraName:e.loraName,lock:r}),_(Oo,null),n.weights[y.TENC]&&_("section",{className:"border p"},_(ye,{label:y.TENC,values:n.weights})),[y.UNET,y.START,y.STOP].map(l=>n.weights[l]&&_("section",{className:"border p",style:q(!o.isMoreButtonVisible||n.weights[l].initCheckState||n.weights[l].initValue!==k(l).default)},_(ye,{label:l,values:n.weights}))),_("button",{style:o.isMoreButtonVisible?{}:{display:"none"},disabled:O(e),onClick:()=>t({type:"HIDE_MORE_BUTTON"})},"show more options"),_("section",{className:"border p"},_("label",null,"LBW"),_("div",{className:"f col g-4 w-fill"},_(Io,null),_(No,null))),_(Wo,{preview:a,topComponent:i.current}))};function _n(e,t){let{tabId:o,textarea:n,selectionStart:r,selectionEnd:a,namespace:i,loraName:l,loraParams:c,top:p,left:g}=t;It(o),Ot(n),Wt(r),ke(a),Dt(n.value.substring(r,a)),Ut(o),Rt(o),k(y.START).max=Me(),k(y.STOP).max=Me(),k(y.STOP).default=Me();let s=document.getElementById("weight-helper").getBoundingClientRect(),f=window.innerHeight-s.bottom,u=p;f<0&&(s.top<0?u=window.scrollY:u+=f);let h=Ft(i,l,c,u,g);if(e({type:"OPEN_CONTEXT",payload:h}),!h.metadataState){let m=He();Ve(l,!1,m.signal).then(d=>{let S=h.weightState.selectedModelType;(!S||S===v.Unknown)&&(S=d.modelType??v.Unknown);let w=h.weightState.selectedLoraBlockType,E=F(S,w),M=Q(h.weightState.weights,E),L={...h.weightState,selectedModelType:S,selectedLoraBlockType:w},R=I(h.loraName,L).loraParams;h.weightState.xyzMode||(ne(l,{loraParams:R,selectedLoraBlockType:w,selectedModelType:S}),e({type:"SET_HISTORY_INDEX",payload:Y(l).length-1})),e({type:"LOAD_METADATA",payload:{algorithm:d.algorithm||"Unknown",modelType:d.modelType||"Unknown",baseModel:d.baseModel||"Unknown",selectedModelType:S,usingBlocks:d.usingBlocks,blockGroups:E,lbwPresets:N(S,h.weightState.selectedLoraBlockType),weights:M}})}).catch(d=>{d.name!=="AbortError"&&(console.error("Error fetching metadata:",d),e({type:"SET_WAITING",payload:!1}))})}if(!h.previewState.modelId){let m=Lo();Bo(l,m.signal).then(async d=>{d.thumbUrl!==we&&(d.thumbUrl=d.thumbUrl),Mt(l,d),e({type:"LOAD_PREVIEW_DATA",payload:d})}).catch(d=>{d.name!=="AbortError"&&console.error("Error fetching metadata:",d)})}}function Se(e){let t=Ce();e({type:"CLOSE_CONTEXT",payload:t})}function fn(e,t){window.opts.weight_helper_using_execCommand||fe(e,!0),Se(t)}var Do=Oe(null),P=()=>{let e=st(Do);if(!e)throw new Error("useWeightHelper must be used within a WeightHelperProvider");return e},gn=({weightHelperState:e,children:t})=>{let[o,n]=at(mn,e);return _(Do.Provider,{value:{state:o,dispatch:n}},t)},mn=(e,t)=>{if(t.type==="OPEN_CONTEXT")return t.payload;if(t.type==="CLOSE_CONTEXT")return t.payload;if(t.type==="SET_POSITION")return{...e,uiState:{...e.uiState,pos:{...e.uiState.pos,top:t.payload.top,left:t.payload.left}}};if(t.type==="LOAD_METADATA"){let o={...e,metadataState:{...e.metadataState,algorithm:t.payload.algorithm||"Unknown",baseModel:t.payload.baseModel||"Unknown",modelType:t.payload.modelType||"Unknown"},weightState:{...e.weightState,selectedModelType:t.payload.selectedModelType,weights:t.payload.weights},blockGroups:t.payload.blockGroups,lbwPresets:t.payload.lbwPresets,uiState:{...e.uiState,isWaiting:!1}};return t.payload.usingBlocks===null?o.usingBlocks=void 0:t.payload.usingBlocks&&(o.usingBlocks=new Set(t.payload.usingBlocks)),o}else{if(t.type==="SET_WAITING")return{...e,uiState:{...e.uiState,isWaiting:t.payload}};if(t.type==="SET_MODELINFO"){let o={...e,weightState:{...e.weightState,selectedLoraBlockType:t.payload.selectedLoraBlockType,selectedModelType:t.payload.selectedModelType,weights:t.payload.weights},blockGroups:t.payload.blockGroups,lbwPresets:t.payload.lbwPresets};return window.opts.weight_helper_using_execCommand||K(I(o.loraName,o.weightState).loraDefine),o}else if(t.type==="TOGGLE_XYZ_MODE"){let o={...e,weightState:{...e.weightState,xyzMode:!e.weightState.xyzMode}};return window.opts.weight_helper_using_execCommand||K(I(o.loraName,o.weightState).loraDefine),o}else if(t.type==="SET_PRESET"){let o={...e.weightState,weights:{...e.weightState.weights,...t.payload.weights}},n=I(e.loraName,o),r=$(e.loraName,n.loraParams),a={...e,weightState:o,preset:t.payload.preset,lock:r};return window.opts.weight_helper_using_execCommand||K(n.loraDefine),a}else if(t.type==="TOGGLE_LOCK_STATUS"){let o=I(e.loraName,e.weightState).loraParams,n=$(e.loraName,o);return n?ht(e.loraName,o):mt(e.loraName,o),{...e,lock:!n}}else if(t.type==="SET_HISTORY"){let{locked:o,historyIndex:n,preset:r}=t.payload,{selectedLoraBlockType:a,selectedModelType:i,weights:l,lbwe:c,xyzMode:p}=t.payload.weightState,g={...e.weightState,weights:{...e.weightState.weights,...l},selectedLoraBlockType:a,selectedModelType:i,lbwe:c,xyzMode:p},s={...e,historyIndex:n,preset:r,weightState:g,lock:o};return window.opts.weight_helper_using_execCommand||K(I(s.loraName,s.weightState).loraDefine),s}else{if(t.type==="SET_HISTORY_INDEX")return{...e,historyIndex:t.payload};if(t.type==="SET_WEIGHT"){let o={...e.weightState.weights,[t.payload.block]:{...e.weightState.weights[t.payload.block],value:t.payload.value,min:Math.min(t.payload.value,e.weightState.weights[t.payload.block].sliderMin),max:Math.max(t.payload.value,e.weightState.weights[t.payload.block].sliderMax),checkState:t.payload.checkState}},n={...e.weightState,weights:o},r=I(e.loraName,n),a=$(e.loraName,r.loraParams),i={...e,weightState:n,preset:Z(e.weightState.selectedModelType,e.weightState.selectedLoraBlockType,e.lbwPresets,o),lock:a};return window.opts.weight_helper_using_execCommand||K(r.loraDefine),i}else{if(t.type==="HIDE_MORE_BUTTON")return{...e,uiState:{...e.uiState,isMoreButtonVisible:!1}};if(t.type==="CLEAR_HISTORY"){gt(e.loraName),e.weightState.xyzMode||ne(e.loraName,{loraParams:I(e.loraName,e.weightState).loraParams,...e.weightState});let o=Y(e.loraName).length-1;return{...e,historyIndex:o<0?0:o}}else return t.type==="LOAD_PREVIEW_DATA"?{...e,previewState:t.payload}:t.type==="SET_PREVIEW_DESCRIPTION_VISIBLE"?{...e,previewState:{...e.previewState,isDescriptionVisible:t.payload}}:t.type==="HIDE_TAG_INSERT_BUTTON"?{...e,previewState:{...e.previewState,isTagInsertButtonVisible:!1}}:e}}}};function Uo(e){tt(_(gn,{weightHelperState:e},_(Ao,null)),document.getElementById("weight-helper-container"))}var Fe,hn=new Promise(e=>{Fe=e});St();onUiLoaded(()=>{if(!gradioApp().querySelector("#lbw_ratiospreset"))return;let o=[...getComputedStyle(document.documentElement).getPropertyValue("--body-text-color").trim().slice(1).match(/.{1,2}/g).map(n=>parseInt(n,16)),.3];document.documentElement.style.setProperty("--weight-helper-shadow",`rgba(${o.join(",")})`),document.documentElement.style.setProperty("--weight-helper-slider_size",String(window.opts.weight_helper_slider_length)),hn.then(()=>{let n=document.createElement("div");n.id="weight-helper-container",gradioApp().appendChild(n),_t(),Uo(Ce())})});onOptionsChanged(()=>{Fe&&(Fe(!0),Fe=null)});})();
//# sourceMappingURL=weight_helper.js.map
